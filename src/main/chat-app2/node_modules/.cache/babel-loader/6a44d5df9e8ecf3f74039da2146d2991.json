{"ast":null,"code":"import _slicedToArray from \"C:/Users/\\uC774\\uACBD\\uBBFC/IdeaProjects/sendbird-uikit-whatsapp-sample/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _defineProperty from \"C:/Users/\\uC774\\uACBD\\uBBFC/IdeaProjects/sendbird-uikit-whatsapp-sample/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport React__default, { useReducer, useContext, createContext } from 'react';\nimport { _ as _objectSpread2 } from './_rollupPluginBabelHelpers-6bb0305c.js';\nimport { f as VOICE_PLAYER_ROOT_ID, g as VOICE_PLAYER_AUDIO_ID, b as VOICE_MESSAGE_FILE_NAME, c as VOICE_MESSAGE_MIME_TYPE } from './consts-95d8566e.js';\nimport useSendbirdStateContext from './useSendbirdStateContext.js';\nvar INITIALIZE_AUDIO_UNIT = 'INITIALIZE_AUDIO_UNIT';\nvar SET_CURRENT_PLAYER = 'SET_CURRENT_PLAYER';\nvar ON_VOICE_PLAYER_PLAY = 'ON_VOICE_PLAYER_PLAY';\nvar ON_VOICE_PLAYER_PAUSE = 'ON_VOICE_PLAYER_PAUSE';\nvar ON_CURRENT_TIME_UPDATE = 'ON_CURRENT_TIME_UPDATE';\nvar VOICE_PLAYER_STATUS = {\n  IDLE: 'IDLE',\n  PREPARING: 'PREPARING',\n  PLAYING: 'PLAYING',\n  PAUSED: 'PAUSED',\n  COMPLETED: 'COMPLETED'\n};\nvar AudioUnitDefaultValue = function AudioUnitDefaultValue() {\n  return {\n    audioFile: null,\n    playbackTime: 0,\n    duration: 1000,\n    playingStatus: VOICE_PLAYER_STATUS.IDLE\n  };\n};\nvar voicePlayerInitialState = {\n  currentPlayer: null,\n  currentGroupKey: '',\n  audioStorage: {}\n};\nfunction voicePlayerReducer(state, action) {\n  switch (action.type) {\n    case INITIALIZE_AUDIO_UNIT:\n      {\n        var _state$audioStorage;\n        var groupKey = action.payload.groupKey;\n        var audioUnit = (_state$audioStorage = state.audioStorage) !== null && _state$audioStorage !== void 0 && _state$audioStorage[groupKey] ? state.audioStorage[groupKey] : AudioUnitDefaultValue();\n        audioUnit.playingStatus = VOICE_PLAYER_STATUS.PREPARING;\n        return _objectSpread2(_objectSpread2({}, state), {}, {\n          audioStorage: _objectSpread2(_objectSpread2({}, state.audioStorage), {}, _defineProperty({}, groupKey, audioUnit))\n        });\n      }\n    case SET_CURRENT_PLAYER:\n      {\n        var _action$payload = action.payload,\n          audioPlayer = _action$payload.audioPlayer,\n          _groupKey = _action$payload.groupKey;\n        return _objectSpread2(_objectSpread2({}, state), {}, {\n          currentPlayer: audioPlayer,\n          currentGroupKey: _groupKey\n        });\n      }\n    case ON_VOICE_PLAYER_PLAY:\n      {\n        var _state$audioStorage2;\n        var _action$payload2 = action.payload,\n          _groupKey2 = _action$payload2.groupKey,\n          audioFile = _action$payload2.audioFile;\n        var _audioUnit = (_state$audioStorage2 = state.audioStorage) !== null && _state$audioStorage2 !== void 0 && _state$audioStorage2[_groupKey2] ? state.audioStorage[_groupKey2] : AudioUnitDefaultValue();\n        _audioUnit.audioFile = audioFile;\n        _audioUnit.playingStatus = VOICE_PLAYER_STATUS.PLAYING;\n        return _objectSpread2(_objectSpread2({}, state), {}, {\n          audioStorage: _objectSpread2(_objectSpread2({}, state.audioStorage), {}, _defineProperty({}, _groupKey2, _audioUnit))\n        });\n      }\n    case ON_VOICE_PLAYER_PAUSE:\n      {\n        var _state$audioStorage3;\n        var _groupKey3 = action.payload.groupKey;\n        var _audioUnit2 = (_state$audioStorage3 = state.audioStorage) !== null && _state$audioStorage3 !== void 0 && _state$audioStorage3[_groupKey3] ? state.audioStorage[_groupKey3] : AudioUnitDefaultValue();\n        _audioUnit2.playingStatus = VOICE_PLAYER_STATUS.PAUSED;\n        var _state$currentPlayer = state.currentPlayer,\n          currentTime = _state$currentPlayer.currentTime,\n          duration = _state$currentPlayer.duration;\n        if (_audioUnit2.playbackTime === _audioUnit2.duration) {\n          _audioUnit2.playbackTime = 0;\n        } else if (currentTime > 0 && duration > 0) {\n          _audioUnit2.playbackTime = currentTime;\n          _audioUnit2.duration = duration;\n        }\n        return _objectSpread2(_objectSpread2({}, state), {}, {\n          audioStorage: _objectSpread2(_objectSpread2({}, state.audioStorage), {}, _defineProperty({}, _groupKey3, _audioUnit2))\n        });\n      }\n    case ON_CURRENT_TIME_UPDATE:\n      {\n        var _state$audioStorage4;\n        var _groupKey4 = action.payload.groupKey;\n        var _state$currentPlayer2 = state.currentPlayer,\n          _currentTime = _state$currentPlayer2.currentTime,\n          _duration = _state$currentPlayer2.duration;\n        var _audioUnit3 = (_state$audioStorage4 = state.audioStorage) !== null && _state$audioStorage4 !== void 0 && _state$audioStorage4[_groupKey4] ? state.audioStorage[_groupKey4] : AudioUnitDefaultValue();\n        if (_currentTime > 0 && _duration > 0) {\n          _audioUnit3.playbackTime = _currentTime;\n          _audioUnit3.duration = _duration;\n        }\n        return _objectSpread2(_objectSpread2({}, state), {}, {\n          audioStorage: _objectSpread2(_objectSpread2({}, state.audioStorage), {}, _defineProperty({}, _groupKey4, _audioUnit3))\n        });\n      }\n    default:\n      return state;\n  }\n}\n\n// VoicePlayerProvider interface\n\nvar noop = function noop() {/* noop */};\nvar VoicePlayerStoreDefaultValue = {\n  currentGroupKey: '',\n  currentPlayer: null,\n  audioStorage: {}\n};\nvar Context = /*#__PURE__*/createContext({\n  play: noop,\n  pause: noop,\n  stop: noop,\n  voicePlayerStore: VoicePlayerStoreDefaultValue\n});\nvar VoicePlayerProvider = function VoicePlayerProvider(_ref) {\n  var children = _ref.children;\n  var _useReducer = useReducer(voicePlayerReducer, voicePlayerInitialState),\n    _useReducer2 = _slicedToArray(_useReducer, 2),\n    voicePlayerStore = _useReducer2[0],\n    voicePlayerDispatcher = _useReducer2[1];\n  var currentGroupKey = voicePlayerStore.currentGroupKey,\n    currentPlayer = voicePlayerStore.currentPlayer,\n    audioStorage = voicePlayerStore.audioStorage;\n  var _useSendbirdStateCont = useSendbirdStateContext(),\n    config = _useSendbirdStateCont.config;\n  var logger = config.logger;\n  var stop = function stop() {\n    var text = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    if (currentGroupKey.includes(text)) {\n      logger.info('VoicePlayer: Pause playing(by text).');\n      pause(currentGroupKey);\n    }\n  };\n  var pause = function pause(groupKey) {\n    if (currentGroupKey === groupKey && currentPlayer !== null) {\n      logger.info('VoicePlayer: Pause playing(by group key).');\n      currentPlayer === null || currentPlayer === void 0 ? void 0 : currentPlayer.pause();\n    }\n  };\n  var play = function play(_ref2) {\n    var groupKey = _ref2.groupKey,\n      _ref2$audioFile = _ref2.audioFile,\n      audioFile = _ref2$audioFile === void 0 ? null : _ref2$audioFile,\n      _ref2$audioFileUrl = _ref2.audioFileUrl,\n      audioFileUrl = _ref2$audioFileUrl === void 0 ? '' : _ref2$audioFileUrl;\n    if (groupKey !== currentGroupKey) {\n      pause(currentGroupKey);\n    }\n\n    // Clear the previous AudioPlayer element\n    var voicePlayerRoot = document.getElementById(VOICE_PLAYER_ROOT_ID);\n    var voicePlayerAudioElement = document.getElementById(VOICE_PLAYER_AUDIO_ID);\n    if (voicePlayerAudioElement) {\n      voicePlayerRoot.removeChild(voicePlayerAudioElement);\n    }\n    logger.info('VoicePlayer: Start getting audio file.');\n    new Promise(function (resolve) {\n      var _audioStorage$groupKe;\n      if (audioFile) {\n        resolve(audioFile);\n        logger.info('VoicePlayer: Use the audioFile instance.');\n      }\n      if (audioStorage !== null && audioStorage !== void 0 && (_audioStorage$groupKe = audioStorage[groupKey]) !== null && _audioStorage$groupKe !== void 0 && _audioStorage$groupKe.audioFile) {\n        resolve(audioStorage[groupKey].audioFile);\n        logger.info('VoicePlayer: Get from the audioStorage.');\n      }\n      voicePlayerDispatcher({\n        type: INITIALIZE_AUDIO_UNIT,\n        payload: {\n          groupKey: groupKey\n        }\n      });\n      fetch(audioFileUrl).then(function (res) {\n        return res.blob();\n      }).then(function (blob) {\n        var audioFile = new File([blob], VOICE_MESSAGE_FILE_NAME, {\n          lastModified: new Date().getTime(),\n          type: VOICE_MESSAGE_MIME_TYPE\n        });\n        resolve(audioFile);\n        logger.info('VoicePlayer: Get the audioFile from URL.');\n      });\n    }).then(function (audioFile) {\n      var _URL, _URL$createObjectURL;\n      logger.info('VoicePlayer: Succeeded getting audio file.', audioFile);\n      var currentAudioUnit = audioStorage[groupKey] || AudioUnitDefaultValue();\n      var audioPlayer = new Audio((_URL = URL) === null || _URL === void 0 ? void 0 : (_URL$createObjectURL = _URL.createObjectURL) === null || _URL$createObjectURL === void 0 ? void 0 : _URL$createObjectURL.call(_URL, audioFile));\n      audioPlayer.id = VOICE_PLAYER_AUDIO_ID;\n      audioPlayer.currentTime = currentAudioUnit.playbackTime;\n      audioPlayer.volume = 1;\n      audioPlayer.loop = false;\n      audioPlayer.onplaying = function () {\n        logger.info('VoicePlayer: OnPlaying event is called from audioPlayer', {\n          groupKey: groupKey,\n          audioPlayer: audioPlayer\n        });\n        voicePlayerDispatcher({\n          type: ON_VOICE_PLAYER_PLAY,\n          payload: {\n            groupKey: groupKey,\n            audioFile: audioFile\n          }\n        });\n      };\n      audioPlayer.onpause = function () {\n        logger.info('VoicePlayer: OnPause event is called from audioPlayer', {\n          groupKey: groupKey,\n          audioPlayer: audioPlayer\n        });\n        voicePlayerDispatcher({\n          type: ON_VOICE_PLAYER_PAUSE,\n          payload: {\n            groupKey: groupKey\n          }\n        });\n      };\n      audioPlayer.ontimeupdate = function () {\n        voicePlayerDispatcher({\n          type: ON_CURRENT_TIME_UPDATE,\n          payload: {\n            groupKey: groupKey\n          }\n        });\n      };\n      audioPlayer === null || audioPlayer === void 0 ? void 0 : audioPlayer.play();\n      var voicePlayerRoot = document.getElementById(VOICE_PLAYER_ROOT_ID);\n      voicePlayerRoot.appendChild(audioPlayer);\n      voicePlayerDispatcher({\n        type: SET_CURRENT_PLAYER,\n        payload: {\n          groupKey: groupKey,\n          audioPlayer: audioPlayer\n        }\n      });\n      logger.info('VoicePlayer: Succeeded playing audio player.', {\n        groupKey: groupKey,\n        audioPlayer: audioPlayer\n      });\n    });\n  };\n  return /*#__PURE__*/React__default.createElement(Context.Provider, {\n    value: {\n      play: play,\n      pause: pause,\n      stop: stop,\n      voicePlayerStore: voicePlayerStore\n    }\n  }, /*#__PURE__*/React__default.createElement(\"div\", {\n    id: VOICE_PLAYER_ROOT_ID,\n    style: {\n      display: 'none'\n    }\n  }), children);\n};\nvar useVoicePlayerContext = function useVoicePlayerContext() {\n  return useContext(Context);\n};\nexport { AudioUnitDefaultValue as A, VoicePlayerProvider as V, VOICE_PLAYER_STATUS as a, useVoicePlayerContext as u };","map":{"version":3,"mappings":";;;;;;AAYO,IAAMA,qBAA4C,GAAG,uBAAuB;AAC5E,IAAMC,kBAAyC,GAAG,oBAAoB;AACtE,IAAMC,oBAA2C,GAAG,sBAAsB;AAC1E,IAAMC,qBAA4C,GAAG,uBAAuB;AAC5E,IAAMC,sBAA6C,GAAG,wBAAwB;ACb9E,IAAMC,mBAAmB,GAAG;EACjCC,IAAI,EAAE,MAAM;EACZC,SAAS,EAAE,WAAW;EACtBC,OAAO,EAAE,SAAS;EAClBC,MAAM,EAAE,QAAQ;EAChBC,SAAS,EAAE;AACb;AAWaC,yBAAqB,GAAGA,SAAxBA,qBAAqB;EAAA,OAA4B;IAC5DC,SAAS,EAAE,IAAI;IACfC,YAAY,EAAE,CAAC;IACfC,QAAQ,EAAE,IAAI;IACdC,aAAa,EAAEV,mBAAmB,CAACC;EACrC,CAAC;AAAA;AAQM,IAAMU,uBAAgD,GAAG;EAC9DC,aAAa,EAAE,IAAI;EACnBC,eAAe,EAAE,EAAE;EACnBC,YAAY,EAAE;AAChB,CAAC;ACNc,SAASC,kBAAkBA,CACxCC,KAA8B,EAC9BC,MAAkB,EACO;EACzB,QAAQA,MAAM,CAACC,IAAI;IACjB,KAAKvB,qBAAqB;MAAE;QAAA;QAC1B,IAAQwB,WAAaF,MAAM,CAACG,OAAqC,CAAzDD;QACR,IAAME,SAAS,GAAI,4BAAK,CAACP,YAAY,sCAAlBQ,8BAAqBH,QAAQ,CAAC,GAAGH,KAAK,CAACF,YAAY,CAACK,QAAQ,CAAC,GAAGb,qBAAqB,EAAuB;QAC/He,SAAS,CAACX,aAAa,GAAGV,mBAAmB,CAACE,SAAS;QACvD,yCACKc,KAAK;UACRF,YAAY,gCACPE,SAAK,CAACF,YAAY,2BACpBK,QAAQ,EAAGE;QACb;MAEL;IACA,KAAKzB,kBAAkB;MAAE;QACvB,sBAAkCqB,MAAM,CAACG,OAAkC;UAAnEG,WAAW,mBAAXA,WAAW;UAAEJ;QACrB,yCACKH,KAAK;UACRJ,aAAa,EAAEW,WAAW;UAC1BV,eAAe,EAAEM;QAAQ;MAE7B;IACA,KAAKtB,oBAAoB;MAAE;QAAA;QACzB,uBAAgCoB,MAAM,CAACG,OAAmC;UAAlED,UAAQ,oBAARA,QAAQ;UAAEZ;QAClB,IAAMc,UAAS,GAAI,6BAAK,CAACP,YAAY,uCAAlBU,+BAAqBL,UAAQ,CAAC,GAAGH,KAAK,CAACF,YAAY,CAACK,UAAQ,CAAC,GAAGb,qBAAqB,EAAuB;QAC/He,UAAS,CAACd,SAAS,GAAGA,SAAS;QAC/Bc,UAAS,CAACX,aAAa,GAAGV,mBAAmB,CAACG,OAAO;QACrD,yCACKa,KAAK;UACRF,YAAY,gCACPE,SAAK,CAACF,YAAY,2BACpBK,UAAQ,EAAGE;QACb;MAEL;IACA,KAAKvB,qBAAqB;MAAE;QAAA;QAC1B,IAAQqB,aAAaF,MAAM,CAACG,OAAoC,CAAxDD;QACR,IAAME,WAAS,GAAI,6BAAK,CAACP,YAAY,uCAAlBW,+BAAqBN,UAAQ,CAAC,GAAGH,KAAK,CAACF,YAAY,CAACK,UAAQ,CAAC,GAAGb,qBAAqB,EAAuB;QAC/He,WAAS,CAACX,aAAa,GAAGV,mBAAmB,CAACI,MAAM;QACpD,2BAAkCY,KAAK,CAACJ,aAAiC;UAAjEc,WAAW,wBAAXA,WAAW;UAAEjB;QACrB,IAAIY,WAAS,CAACb,YAAY,KAAKa,WAAS,CAACZ,QAAQ,EAAE;UACjDY,WAAS,CAACb,YAAY,GAAG,CAAC;SAC3B,MAAM,IAAIkB,WAAW,GAAG,CAAC,IAAIjB,QAAQ,GAAG,CAAC,EAAE;UAC1CY,WAAS,CAACb,YAAY,GAAGkB,WAAW;UACpCL,WAAS,CAACZ,QAAQ,GAAGA,QAAQ;QAC/B;QACA,yCACKO,KAAK;UACRF,YAAY,gCACPE,SAAK,CAACF,YAAY,2BACpBK,UAAQ,EAAGE;QACb;MAEL;IACA,KAAKtB,sBAAsB;MAAE;QAAA;QAC3B,IAAQoB,aAAaF,MAAM,CAACG,OAAqC,CAAzDD;QACR,4BAAkCH,KAAK,CAACJ,aAAiC;UAAjEc,YAAW,yBAAXA,WAAW;UAAEjB;QACrB,IAAMY,WAAS,GAAI,6BAAK,CAACP,YAAY,uCAAlBa,+BAAqBR,UAAQ,CAAC,GAAGH,KAAK,CAACF,YAAY,CAACK,UAAQ,CAAC,GAAGb,qBAAqB,EAAuB;QAC/H,IAAIoB,YAAW,GAAG,CAAC,IAAIjB,SAAQ,GAAG,CAAC,EAAE;UACnCY,WAAS,CAACb,YAAY,GAAGkB,YAAW;UACpCL,WAAS,CAACZ,QAAQ,GAAGA,SAAQ;QAC/B;QACA,yCACKO,KAAK;UACRF,YAAY,gCACPE,SAAK,CAACF,YAAY,2BACpBK,UAAQ,EAAGE;QACb;MAEL;IACA;MACE,OAAOL,KAAK;EAAA;AAElB;;ACpFA;;AAgBA,IAAMY,IAAI,GAAGA,SAAPA,IAAI,GAAS,YAAc;AACjC,IAAMC,4BAA4B,GAAG;EACnChB,eAAe,EAAE,EAAE;EACnBD,aAAa,EAAE,IAAI;EACnBE,YAAY,EAAE;AAChB,CAAC;AAED,IAAMgB,OAAO,gBAAGC,aAAa,CAAqB;EAChDC,IAAI,EAAEJ,IAAI;EACVK,KAAK,EAAEL,IAAI;EACXM,IAAI,EAAEN,IAAI;EACVO,gBAAgB,EAAEN;AACpB,CAAC,CAAC;AAEWO,uBAAmB,GAAGC,SAAtBD,mBAAmB,CAAGC,MAES;EAAA,IAD1CC,WACiBD,KADjBC;EAEA,kBAAkDC,UAAU,CAACxB,kBAAkB,EAAEJ,uBAAuB,CAAC;IAAA;IAAlGwB,gBAAgB;IAAEK,qBAAqB;EAC9C,IACE3B,eAAe,GAGbsB,gBAAgB,CAHlBtB,eAAe;IACfD,aAAa,GAEXuB,gBAAgB,CAFlBvB,aAAa;IACbE,eACEqB,gBAAgB,CADlBrB;EAEF,4BAAmB2B,uBAAuB,EAAE;IAApCC;EACR,IAAQC,SAAWD,MAAM,CAAjBC;EAER,IAAMT,IAAI,GAAG,SAAPA,IAAI,GAAkB;IAAA,IAAdU,IAAI,uEAAG,EAAE;IACrB,IAAI/B,eAAe,CAACgC,QAAQ,CAACD,IAAI,CAAC,EAAE;MAClCD,MAAM,CAACG,IAAI,CAAC,sCAAsC,CAAC;MACnDb,KAAK,CAACpB,eAAe,CAAC;IACxB;GACD;EAED,IAAMoB,KAAK,GAAId,SAATc,KAAK,CAAId,QAAgB,EAAK;IAClC,IAAIN,eAAe,KAAKM,QAAQ,IAAIP,aAAa,KAAK,IAAI,EAAE;MAC1D+B,MAAM,CAACG,IAAI,CAAC,2CAA2C,CAAC;MACxDlC,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEqB,KAAK,EAAE;IACxB;GACD;EAED,IAAMD,IAAI,GAAGe,SAAPf,IAAI,CAAGe,OAIqB;IAAA,IAHhC5B,QAAQ,GAGa4B,MAHrB5B,QAAQ;MAAA,kBAGa4B,MAFrBxC,SAAS;MAATA,SAAS,gCAAG,IAAI;MAAA,qBAEKwC,MADrBC,YAAY;MAAZA,YAAY,mCAAG;IAEf,IAAI7B,QAAQ,KAAKN,eAAe,EAAE;MAChCoB,KAAK,CAACpB,eAAe,CAAC;IACxB;;IAEA;IACA,IAAMoC,eAAe,GAAGC,QAAQ,CAACC,cAAc,CAACC,oBAAoB,CAAC;IACrE,IAAMC,uBAAuB,GAAGH,QAAQ,CAACC,cAAc,CAACG,qBAAqB,CAAC;IAC9E,IAAID,uBAAuB,EAAE;MAC3BJ,eAAe,CAACM,WAAW,CAACF,uBAAuB,CAAC;IACtD;IAEAV,MAAM,CAACG,IAAI,CAAC,wCAAwC,CAAC;IACrD,IAAIU,OAAO,CAAEC,iBAAO,EAAK;MAAA;MACvB,IAAIlD,SAAS,EAAE;QACbkD,OAAO,CAAClD,SAAS,CAAC;QAClBoC,MAAM,CAACG,IAAI,CAAC,0CAA0C,CAAC;MACzD;MACA,IAAIhC,YAAY,KAAZA,oBAAY,wCAAZA,YAAY,CAAGK,QAAQ,CAAC,kDAAxBuC,sBAA0BnD,SAAS,EAAE;QACvCkD,OAAO,CAAC3C,YAAY,CAACK,QAAQ,CAAC,CAACZ,SAAS,CAAC;QACzCoC,MAAM,CAACG,IAAI,CAAC,yCAAyC,CAAC;MACxD;MACAN,qBAAqB,CAAC;QACpBtB,IAAI,EAAEvB,qBAAqB;QAC3ByB,OAAO,EAAE;UAAED;QAAS;MACtB,CAAC,CAAC;MACFwC,KAAK,CAACX,YAAY,CAAC,CAChBY,IAAI,CAAEC,aAAG;QAAA,OAAKA,GAAG,CAACC,IAAI,EAAE;MAAA,EAAC,CACzBF,IAAI,CAAEE,cAAI,EAAK;QACd,IAAMvD,SAAS,GAAG,IAAIwD,IAAI,CAAC,CAACD,IAAI,CAAC,EAAEE,uBAAuB,EAAE;UAC1DC,YAAY,EAAE,IAAIC,IAAI,EAAE,CAACC,OAAO,EAAE;UAClCjD,IAAI,EAAEkD;QACR,CAAC,CAAC;QACFX,OAAO,CAAClD,SAAS,CAAC;QAClBoC,MAAM,CAACG,IAAI,CAAC,0CAA0C,CAAC;MACzD,CAAC,CAAC;IACN,CAAC,CAAC,CAACc,IAAI,CAAErD,mBAAe,EAAK;MAAA;MAC3BoC,MAAM,CAACG,IAAI,CAAC,4CAA4C,EAAEvC,SAAS,CAAC;MACpE,IAAM8D,gBAAgB,GAAGvD,YAAY,CAACK,QAAQ,CAAC,IAAIb,qBAAqB,EAAsB;MAC9F,IAAMiB,WAAW,GAAG,IAAI+C,KAAK,SAACC,GAAG,iEAAHC,KAAKC,eAAe,yDAApBC,gCAAuBnE,SAAS,CAAC,CAAC;MAChEgB,WAAW,CAACoD,EAAE,GAAGrB,qBAAqB;MACtC/B,WAAW,CAACG,WAAW,GAAG2C,gBAAgB,CAAC7D,YAAY;MACvDe,WAAW,CAACqD,MAAM,GAAG,CAAC;MACtBrD,WAAW,CAACsD,IAAI,GAAG,KAAK;MACxBtD,WAAW,CAACuD,SAAS,GAAG,YAAM;QAC5BnC,MAAM,CAACG,IAAI,CAAC,yDAAyD,EAAE;UAAE3B,QAAQ,EAARA,QAAQ;UAAEI;QAAY,CAAC,CAAC;QACjGiB,qBAAqB,CAAC;UACpBtB,IAAI,EAAErB,oBAAoB;UAC1BuB,OAAO,EAAE;YAAED,QAAQ,EAARA,QAAQ;YAAEZ;UAAU;QACjC,CAAC,CAAC;OACH;MACDgB,WAAW,CAACwD,OAAO,GAAG,YAAM;QAC1BpC,MAAM,CAACG,IAAI,CAAC,uDAAuD,EAAE;UAAE3B,QAAQ,EAARA,QAAQ;UAAEI;QAAY,CAAC,CAAC;QAC/FiB,qBAAqB,CAAC;UACpBtB,IAAI,EAAEpB,qBAAqB;UAC3BsB,OAAO,EAAE;YAAED;UAAS;QACtB,CAAC,CAAC;OACH;MACDI,WAAW,CAACyD,YAAY,GAAG,YAAM;QAC/BxC,qBAAqB,CAAC;UACpBtB,IAAI,EAAEnB,sBAAsB;UAC5BqB,OAAO,EAAE;YAAED;UAAS;QACtB,CAAC,CAAC;OACH;MACDI,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAES,IAAI,EAAE;MACnB,IAAMiB,eAAe,GAAGC,QAAQ,CAACC,cAAc,CAACC,oBAAoB,CAAC;MACrEH,eAAe,CAACgC,WAAW,CAAC1D,WAAW,CAAC;MACxCiB,qBAAqB,CAAC;QACpBtB,IAAI,EAAEtB,kBAAkB;QACxBwB,OAAO,EAAE;UAAED,QAAQ,EAARA,QAAQ;UAAEI;QAAY;MACnC,CAAC,CAAC;MACFoB,MAAM,CAACG,IAAI,CAAC,8CAA8C,EAAE;QAAE3B,QAAQ,EAARA,QAAQ;QAAEI;MAAY,CAAC,CAAC;IACxF,CAAC,CAAC;GACH;EAED,oBACE2D,6BAACpD,OAAO,CAACqD,QAAQ;IAACC,KAAK,EAAE;MACvBpD,IAAI,EAAJA,IAAI;MACJC,KAAK,EAALA,KAAK;MACLC,IAAI,EAAJA,IAAI;MACJC;IACF;GACE+C;IAAKP,EAAE,EAAEvB,oBAAqB;IAACiC,KAAK,EAAE;MAAEC,OAAO,EAAE;IAAO;GAAK,GAC5DhD,QAAQ,CACQ;AAEvB;AAEO,IAAMiD,qBAAqB,GAAGA,SAAxBA,qBAAqB;EAAA,OAA6BC,UAAU,CAAC1D,OAAO;AAAA","names":["INITIALIZE_AUDIO_UNIT","SET_CURRENT_PLAYER","ON_VOICE_PLAYER_PLAY","ON_VOICE_PLAYER_PAUSE","ON_CURRENT_TIME_UPDATE","VOICE_PLAYER_STATUS","IDLE","PREPARING","PLAYING","PAUSED","COMPLETED","AudioUnitDefaultValue","audioFile","playbackTime","duration","playingStatus","voicePlayerInitialState","currentPlayer","currentGroupKey","audioStorage","voicePlayerReducer","state","action","type","groupKey","payload","audioUnit","_state$audioStorage","audioPlayer","_state$audioStorage2","_state$audioStorage3","currentTime","_state$audioStorage4","noop","VoicePlayerStoreDefaultValue","Context","createContext","play","pause","stop","voicePlayerStore","VoicePlayerProvider","_ref","children","useReducer","voicePlayerDispatcher","useSendbirdStateContext","config","logger","text","includes","info","_ref2","audioFileUrl","voicePlayerRoot","document","getElementById","VOICE_PLAYER_ROOT_ID","voicePlayerAudioElement","VOICE_PLAYER_AUDIO_ID","removeChild","Promise","resolve","_audioStorage$groupKe","fetch","then","res","blob","File","VOICE_MESSAGE_FILE_NAME","lastModified","Date","getTime","VOICE_MESSAGE_MIME_TYPE","currentAudioUnit","Audio","URL","_URL","createObjectURL","_URL$createObjectURL","id","volume","loop","onplaying","onpause","ontimeupdate","appendChild","React","Provider","value","style","display","useVoicePlayerContext","useContext"],"sources":["C:\\Users\\이경민\\IdeaProjects\\sendbird-uikit-whatsapp-sample\\node_modules\\@sendbird\\src\\hooks\\VoicePlayer\\dux\\actionTypes.ts","C:\\Users\\이경민\\IdeaProjects\\sendbird-uikit-whatsapp-sample\\node_modules\\@sendbird\\src\\hooks\\VoicePlayer\\dux\\initialState.ts","C:\\Users\\이경민\\IdeaProjects\\sendbird-uikit-whatsapp-sample\\node_modules\\@sendbird\\src\\hooks\\VoicePlayer\\dux\\reducer.ts","C:\\Users\\이경민\\IdeaProjects\\sendbird-uikit-whatsapp-sample\\node_modules\\@sendbird\\src\\hooks\\VoicePlayer\\index.tsx"],"sourcesContent":["import { ObjectValues } from '../../../utils/typeHelpers/objectValues';\n\nexport const actionTypes = {\n  INITIALIZE_AUDIO_UNIT: 'INITIALIZE_AUDIO_UNIT',\n  SET_CURRENT_PLAYER: 'SET_CURRENT_PLAYER',\n  ON_VOICE_PLAYER_PLAY: 'ON_VOICE_PLAYER_PLAY',\n  ON_VOICE_PLAYER_PAUSE: 'ON_VOICE_PLAYER_PAUSE',\n  ON_CURRENT_TIME_UPDATE: 'ON_CURRENT_TIME_UPDATE',\n} as const;\n\nexport type VoicePlayerActionType = ObjectValues<typeof actionTypes>;\n\nexport const INITIALIZE_AUDIO_UNIT: VoicePlayerActionType = 'INITIALIZE_AUDIO_UNIT';\nexport const SET_CURRENT_PLAYER: VoicePlayerActionType = 'SET_CURRENT_PLAYER';\nexport const ON_VOICE_PLAYER_PLAY: VoicePlayerActionType = 'ON_VOICE_PLAYER_PLAY';\nexport const ON_VOICE_PLAYER_PAUSE: VoicePlayerActionType = 'ON_VOICE_PLAYER_PAUSE';\nexport const ON_CURRENT_TIME_UPDATE: VoicePlayerActionType = 'ON_CURRENT_TIME_UPDATE';\n","import { ObjectValues } from '../../../utils/typeHelpers/objectValues';\nimport { GroupKey } from '../utils';\n\nexport const VOICE_PLAYER_STATUS = {\n  IDLE: 'IDLE',\n  PREPARING: 'PREPARING',\n  PLAYING: 'PLAYING',\n  PAUSED: 'PAUSED',\n  COMPLETED: 'COMPLETED',\n} as const;\n// VoicePlayerStatus should be deprecated / It's left for backward legacy\nexport const VoicePlayerStatus = VOICE_PLAYER_STATUS;\nexport type VoicePlayerStatusType = ObjectValues<typeof VOICE_PLAYER_STATUS>;\n\nexport type AudioStorageUnit = {\n  playingStatus: VoicePlayerStatusType;\n  audioFile: null | File;\n  playbackTime: number;\n  duration: number;\n};\nexport const AudioUnitDefaultValue = (): AudioStorageUnit => ({\n  audioFile: null,\n  playbackTime: 0,\n  duration: 1000,\n  playingStatus: VOICE_PLAYER_STATUS.IDLE,\n});\n\nexport interface VoicePlayerInitialState {\n  currentPlayer: null | HTMLAudioElement;\n  currentGroupKey: string;\n  audioStorage: Record<GroupKey, AudioStorageUnit>;\n}\n\nexport const voicePlayerInitialState: VoicePlayerInitialState = {\n  currentPlayer: null,\n  currentGroupKey: '',\n  audioStorage: {},\n};\n","import {\n  INITIALIZE_AUDIO_UNIT,\n  ON_CURRENT_TIME_UPDATE,\n  ON_VOICE_PLAYER_PAUSE,\n  ON_VOICE_PLAYER_PLAY,\n  SET_CURRENT_PLAYER,\n} from './actionTypes';\nimport {\n  AudioStorageUnit,\n  AudioUnitDefaultValue,\n  VoicePlayerInitialState,\n  VOICE_PLAYER_STATUS,\n} from './initialState';\n\ntype InitializeAudioUnitPayload = { groupKey: string };\ntype SetCurrentPlayerPayload = { audioPlayer: HTMLAudioElement, groupKey: string };\ntype OnVoicePlayerPlayPayload = { groupKey: string, audioFile: File };\ntype OnVoicePlayerPausePayload = { groupKey: string };\ntype OnCurrentTimeUpdatePayload = { groupKey: string };\ntype PayloadType = (\n  InitializeAudioUnitPayload\n  | SetCurrentPlayerPayload\n  | OnVoicePlayerPlayPayload\n  | OnVoicePlayerPausePayload\n  | OnCurrentTimeUpdatePayload\n);\ntype ActionType = {\n  type: string;\n  payload: PayloadType;\n};\n\nexport default function voicePlayerReducer(\n  state: VoicePlayerInitialState,\n  action: ActionType,\n): VoicePlayerInitialState {\n  switch (action.type) {\n    case INITIALIZE_AUDIO_UNIT: {\n      const { groupKey } = action.payload as InitializeAudioUnitPayload;\n      const audioUnit = (state.audioStorage?.[groupKey] ? state.audioStorage[groupKey] : AudioUnitDefaultValue()) as AudioStorageUnit;\n      audioUnit.playingStatus = VOICE_PLAYER_STATUS.PREPARING;\n      return {\n        ...state,\n        audioStorage: {\n          ...state.audioStorage,\n          [groupKey]: audioUnit,\n        },\n      };\n    }\n    case SET_CURRENT_PLAYER: {\n      const { audioPlayer, groupKey } = action.payload as SetCurrentPlayerPayload;\n      return {\n        ...state,\n        currentPlayer: audioPlayer,\n        currentGroupKey: groupKey,\n      };\n    }\n    case ON_VOICE_PLAYER_PLAY: {\n      const { groupKey, audioFile } = action.payload as OnVoicePlayerPlayPayload;\n      const audioUnit = (state.audioStorage?.[groupKey] ? state.audioStorage[groupKey] : AudioUnitDefaultValue()) as AudioStorageUnit;\n      audioUnit.audioFile = audioFile;\n      audioUnit.playingStatus = VOICE_PLAYER_STATUS.PLAYING;\n      return {\n        ...state,\n        audioStorage: {\n          ...state.audioStorage,\n          [groupKey]: audioUnit,\n        },\n      };\n    }\n    case ON_VOICE_PLAYER_PAUSE: {\n      const { groupKey } = action.payload as OnVoicePlayerPausePayload;\n      const audioUnit = (state.audioStorage?.[groupKey] ? state.audioStorage[groupKey] : AudioUnitDefaultValue()) as AudioStorageUnit;\n      audioUnit.playingStatus = VOICE_PLAYER_STATUS.PAUSED;\n      const { currentTime, duration } = state.currentPlayer as HTMLAudioElement;\n      if (audioUnit.playbackTime === audioUnit.duration) {\n        audioUnit.playbackTime = 0;\n      } else if (currentTime > 0 && duration > 0) {\n        audioUnit.playbackTime = currentTime;\n        audioUnit.duration = duration;\n      }\n      return {\n        ...state,\n        audioStorage: {\n          ...state.audioStorage,\n          [groupKey]: audioUnit,\n        },\n      };\n    }\n    case ON_CURRENT_TIME_UPDATE: {\n      const { groupKey } = action.payload as OnCurrentTimeUpdatePayload;\n      const { currentTime, duration } = state.currentPlayer as HTMLAudioElement;\n      const audioUnit = (state.audioStorage?.[groupKey] ? state.audioStorage[groupKey] : AudioUnitDefaultValue()) as AudioStorageUnit;\n      if (currentTime > 0 && duration > 0) {\n        audioUnit.playbackTime = currentTime;\n        audioUnit.duration = duration;\n      }\n      return {\n        ...state,\n        audioStorage: {\n          ...state.audioStorage,\n          [groupKey]: audioUnit,\n        },\n      };\n    }\n    default:\n      return state;\n  }\n}\n","import React, { createContext, useContext, useReducer } from 'react';\nimport voicePlayerReducer from './dux/reducer';\nimport {\n  AudioStorageUnit,\n  AudioUnitDefaultValue,\n  VoicePlayerInitialState,\n  voicePlayerInitialState,\n} from './dux/initialState';\nimport {\n  INITIALIZE_AUDIO_UNIT,\n  ON_CURRENT_TIME_UPDATE,\n  ON_VOICE_PLAYER_PAUSE,\n  ON_VOICE_PLAYER_PLAY,\n  SET_CURRENT_PLAYER,\n} from './dux/actionTypes';\nimport {\n  VOICE_MESSAGE_FILE_NAME,\n  VOICE_MESSAGE_MIME_TYPE,\n  VOICE_PLAYER_AUDIO_ID,\n  VOICE_PLAYER_ROOT_ID,\n} from '../../utils/consts';\nimport useSendbirdStateContext from '../useSendbirdStateContext';\n\n// VoicePlayerProvider interface\nexport interface VoicePlayerProps {\n  children: React.ReactElement;\n}\nexport interface VoicePlayerPlayProps {\n  groupKey: string;\n  audioFile?: File;\n  audioFileUrl?: string;\n}\nexport interface VoicePlayerContext {\n  play: (props: VoicePlayerPlayProps) => void;\n  pause: (groupKey?: string) => void;\n  stop: (text?: string) => void;\n  voicePlayerStore: VoicePlayerInitialState;\n}\n\nconst noop = () => { /* noop */ };\nconst VoicePlayerStoreDefaultValue = {\n  currentGroupKey: '',\n  currentPlayer: null,\n  audioStorage: {},\n};\n\nconst Context = createContext<VoicePlayerContext>({\n  play: noop,\n  pause: noop,\n  stop: noop,\n  voicePlayerStore: VoicePlayerStoreDefaultValue,\n});\n\nexport const VoicePlayerProvider = ({\n  children,\n}: VoicePlayerProps): React.ReactElement => {\n  const [voicePlayerStore, voicePlayerDispatcher] = useReducer(voicePlayerReducer, voicePlayerInitialState);\n  const {\n    currentGroupKey,\n    currentPlayer,\n    audioStorage,\n  } = voicePlayerStore;\n  const { config } = useSendbirdStateContext();\n  const { logger } = config;\n\n  const stop = (text = '') => {\n    if (currentGroupKey.includes(text)) {\n      logger.info('VoicePlayer: Pause playing(by text).');\n      pause(currentGroupKey);\n    }\n  };\n\n  const pause = (groupKey: string) => {\n    if (currentGroupKey === groupKey && currentPlayer !== null) {\n      logger.info('VoicePlayer: Pause playing(by group key).');\n      currentPlayer?.pause();\n    }\n  };\n\n  const play = ({\n    groupKey,\n    audioFile = null,\n    audioFileUrl = '',\n  }: VoicePlayerPlayProps): void => {\n    if (groupKey !== currentGroupKey) {\n      pause(currentGroupKey);\n    }\n\n    // Clear the previous AudioPlayer element\n    const voicePlayerRoot = document.getElementById(VOICE_PLAYER_ROOT_ID);\n    const voicePlayerAudioElement = document.getElementById(VOICE_PLAYER_AUDIO_ID);\n    if (voicePlayerAudioElement) {\n      voicePlayerRoot.removeChild(voicePlayerAudioElement);\n    }\n\n    logger.info('VoicePlayer: Start getting audio file.');\n    new Promise((resolve) => {\n      if (audioFile) {\n        resolve(audioFile);\n        logger.info('VoicePlayer: Use the audioFile instance.');\n      }\n      if (audioStorage?.[groupKey]?.audioFile) {\n        resolve(audioStorage[groupKey].audioFile);\n        logger.info('VoicePlayer: Get from the audioStorage.');\n      }\n      voicePlayerDispatcher({\n        type: INITIALIZE_AUDIO_UNIT,\n        payload: { groupKey },\n      });\n      fetch(audioFileUrl)\n        .then((res) => res.blob())\n        .then((blob) => {\n          const audioFile = new File([blob], VOICE_MESSAGE_FILE_NAME, {\n            lastModified: new Date().getTime(),\n            type: VOICE_MESSAGE_MIME_TYPE,\n          });\n          resolve(audioFile);\n          logger.info('VoicePlayer: Get the audioFile from URL.');\n        });\n    }).then((audioFile: File) => {\n      logger.info('VoicePlayer: Succeeded getting audio file.', audioFile);\n      const currentAudioUnit = audioStorage[groupKey] || AudioUnitDefaultValue() as AudioStorageUnit;\n      const audioPlayer = new Audio(URL?.createObjectURL?.(audioFile));\n      audioPlayer.id = VOICE_PLAYER_AUDIO_ID;\n      audioPlayer.currentTime = currentAudioUnit.playbackTime;\n      audioPlayer.volume = 1;\n      audioPlayer.loop = false;\n      audioPlayer.onplaying = () => {\n        logger.info('VoicePlayer: OnPlaying event is called from audioPlayer', { groupKey, audioPlayer });\n        voicePlayerDispatcher({\n          type: ON_VOICE_PLAYER_PLAY,\n          payload: { groupKey, audioFile },\n        });\n      };\n      audioPlayer.onpause = () => {\n        logger.info('VoicePlayer: OnPause event is called from audioPlayer', { groupKey, audioPlayer });\n        voicePlayerDispatcher({\n          type: ON_VOICE_PLAYER_PAUSE,\n          payload: { groupKey },\n        });\n      };\n      audioPlayer.ontimeupdate = () => {\n        voicePlayerDispatcher({\n          type: ON_CURRENT_TIME_UPDATE,\n          payload: { groupKey },\n        });\n      };\n      audioPlayer?.play();\n      const voicePlayerRoot = document.getElementById(VOICE_PLAYER_ROOT_ID);\n      voicePlayerRoot.appendChild(audioPlayer);\n      voicePlayerDispatcher({\n        type: SET_CURRENT_PLAYER,\n        payload: { groupKey, audioPlayer },\n      });\n      logger.info('VoicePlayer: Succeeded playing audio player.', { groupKey, audioPlayer });\n    });\n  };\n\n  return (\n    <Context.Provider value={{\n      play,\n      pause,\n      stop,\n      voicePlayerStore,\n    }}>\n      <div id={VOICE_PLAYER_ROOT_ID} style={{ display: 'none' }} />\n      {children}\n    </Context.Provider>\n  );\n};\n\nexport const useVoicePlayerContext = (): VoicePlayerContext => useContext(Context);\n"]},"metadata":{},"sourceType":"module"}