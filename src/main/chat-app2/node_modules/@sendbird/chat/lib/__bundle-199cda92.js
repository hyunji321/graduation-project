import{_ as e,A as t,Z as n,e as s,f as a,h as i,g as r,U as l,$ as u,m as o,a as d,K as c,q as h,r as p,J as m,T as f,a0 as g,a1 as y,a2 as _,O as v,a3 as I,a4 as T,a5 as M,a6 as S,b,c as U,s as A,S as E,a7 as w,V as F,a8 as q,a9 as D,aa as P,ab as N,W as C,w as R,x as O,ac as L,ad as k,i as z,ae as x,af as Q,ag as G,t as B,ah as j,ai as H,aj as W,n as K,ak as V,B as X,al as J,am as Z}from"./__bundle-2cf2dbb7.js";var $,Y=function(a){function i(e){var i=a.call(this)||this;if(i.method=t.POST,i.path="".concat(n),i.params=s({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var r=0;r<e.thumbnailSizes.length;r++){var l=e.thumbnailSizes[r],u=l.maxWidth,o=l.maxHeight;i.params["thumbnail".concat(r+1)]="".concat(u,",").concat(o)}return i.requestId=e.requestId,i}return e(i,a),i}(a),ee=function(t){function n(e,n){var s,a,i,r=this;return(r=t.call(this,e,n)||this).url=n.url,r.fileSize=null!==(s=n.file_size)&&void 0!==s?s:0,r.thumbnailSizes=null!==(a=n.thumbnails)&&void 0!==a?a:[],r.requireAuth=null!==(i=n.require_auth)&&void 0!==i&&i,r}return e(n,t),n}(i),te=function(t){function n(e,n){var s,a,i,r=this;return(r=t.call(this,e)||this).replyCount=0,r.mostRepliedUsers=null,r.lastRepliedAt=0,r.updatedAt=0,r.replyCount=null!==(s=n.reply_count)&&void 0!==s?s:0,r.mostRepliedUsers=n.hasOwnProperty("most_replies")&&o("object",n.most_replies)?n.most_replies.map((function(e){return new l(r._iid,e)})):[],r.lastRepliedAt=null!==(a=n.last_replied_at)&&void 0!==a?a:0,r.updatedAt=null!==(i=n.updated_at)&&void 0!==i?i:0,r}return e(n,t),n.payloadify=function(e){return e?s(r(r({},t.payloadify.call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map((function(e){return l.payloadify(e)})):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})):null},n}(u);!function(e){e.ADD="add",e.DELETE="delete"}($||($={}));var ne,se,ae=function(e){this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var t=d("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,s=e.operation?e.operation.toLowerCase():null,a=e.reaction,i=e.updated_at;t&&d("string",n)&&d("string",s)&&c($,s)&&d("string",a)&&a&&d("number",i)&&(this.messageId=t,this.userId=n,this.key=a,this.operation=s,this.updatedAt=i)},ie=function(){function e(e){var t,n,s,a=e.key,i=null!==(s=h([],p(e.user_ids),!1))&&void 0!==s?s:[],r=e.updated_at;d("string",a)&&a&&o("string",i)&&i.length>0&&d("number",r)&&(this.key=a,this.userIds=i,this.updatedAt=r);var l={};try{for(var u=m(this.userIds),c=u.next();!c.done;c=u.next()){l[c.value]=this.updatedAt}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}this._version=l}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),e.payloadify=function(e){return e?s({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null},e.prototype.applyEvent=function(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var t=this.userIds.indexOf(e.userId);switch(e.operation){case $.ADD:t<0&&this.userIds.push(e.userId);break;case $.DELETE:t>=0&&this.userIds.splice(t,1)}this._version[e.userId]=e.updatedAt}this.updatedAt=Math.max(this.updatedAt,e.updatedAt)}},e}(),re=function(){function e(e){this.key=e.key,this.value=o("string",e.value)?h([],p(e.value),!1):[]}return e.payloadify=function(e){var t;return e?s({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}):null},e}(),le=function(){function e(e){this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("height")&&(this.height=e.height),e.hasOwnProperty("alt")&&(this.alt=e.alt)}return e.payloadify=function(e){var t,n;return e?s({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(n=e.height)&&void 0!==n?n:0,alt:e.alt}):null},e}(),ue=function(){function e(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new le(e["og:image"]))}return e.payloadify=function(e){return e?s({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?le.payloadify(e.defaultImage):null}):null},e}(),oe=function(){function e(e){var t,n;this.name=null,this.volume=0,this.name=null!==(t=e.name)&&void 0!==t?t:"default",this.volume=null!==(n=e.volume)&&void 0!==n?n:1}return e.prototype.serialize=function(){return{name:this.name,volume:this.volume}},e.payloadify=function(e){return e?s({name:e.name,volume:e.volume}):null},e}(),de=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.role=null,s.isBlockedByMe=!1,s.role=c(f,n.role)?n.role:f.NONE,n.hasOwnProperty("is_blocked_by_me")&&(s.isBlockedByMe=n.is_blocked_by_me),s}return e(n,t),n.payloadify=function(e){return e?s(r(r({},t.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})):null},n}(l);!function(e){e.PENDING="pending",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled"}(ne||(ne={})),function(e){e.PENDING="pending",e.IN_QUEUE="in_queue",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled",e.REMOVED="removed"}(se||(se={}));var ce=function(e){switch(e){case y.BASE:return"";case y.USER:return"MESG";case y.FILE:return"FILE";case y.ADMIN:return"ADMM"}},he=function(t){function n(e,n){var s,a,i,r,u,o,d,h,p,m,f,g,_,T,M,S=this;(S=t.call(this,e)||this).channelUrl=null,S.channelType=v.BASE,S.messageId=0,S.parentMessageId=null,S.parentMessage=null,S.silent=!1,S.isOperatorMessage=!1,S.messageType=y.BASE,S.data=null,S.customType=null,S.mentionType=null,S.mentionedUsers=[],S.mentionedUserIds=[],S.mentionedMessageTemplate=null,S.threadInfo=null,S.reactions=[],S.metaArrays=[],S.ogMetaData=null,S.appleCriticalAlertOptions=null,S.createdAt=0,S.updatedAt=0,S.scheduledInfo=null,S.extendedMessage={},S._isContinuousMessages=!1,S._scheduledStatus=null,S.messageId=null!==(a=null!==(s=n.msg_id)&&void 0!==s?s:n.message_id)&&void 0!==a?a:0,S.channelUrl=n.channel_url,S.channelType=c(v,n.channel_type)?n.channel_type:v.GROUP,n.channel&&(n.channel.channel_url&&(S.channelUrl=n.channel.channel_url),n.channel.channel_type&&(S.channelType=n.channel.channel_type)),S.parentMessageId=null!==(i="string"==typeof n.parent_message_id?parseInt(n.parent_message_id):n.parent_message_id)&&void 0!==i?i:0,S.data=null!==(r=n.data)&&void 0!==r?r:"",S.customType=null!==(u=n.custom_type)&&void 0!==u?u:"",S.mentionType=c(I,n.mention_type)?n.mention_type:null;var b=n.mentioned_users;S.mentionedUsers=b?b.map((function(e){return new l(S._iid,e)})):null;var U=n.mentioned_user_ids;S.mentionedUserIds=null!=U?U:null,S.mentionedUsers&&!S.mentionedUserIds&&(S.mentionedUserIds=S.mentionedUsers.map((function(e){return e.userId}))),S.mentionedMessageTemplate=null!==(o=n.mentioned_message_template)&&void 0!==o?o:"",S.threadInfo=n.thread_info?new te(S._iid,n.thread_info):null,S.reactions=n.reactions?n.reactions.map((function(e){return new ie(e)})):[];for(var A=null!==(d=n.metaarray)&&void 0!==d?d:{},E=null!==(h=n.metaarray_key_order)&&void 0!==h?h:Object.keys(A).sort((function(e,t){return e.localeCompare(t)})),w=0;w<E.length;w++){var F=E[w];S.metaArrays.push(new re({key:F,value:A[F]||[]}))}return n.sorted_metaarray&&(S.metaArrays=n.sorted_metaarray.map((function(e){return new re(e)}))),S.ogMetaData=n.og_tag?new ue(n.og_tag):null,S.silent=null!==(p=n.silent)&&void 0!==p&&p,S.isOperatorMessage=null!==(m=n.is_op_msg)&&void 0!==m&&m,S.appleCriticalAlertOptions=n.apple_critical_alert_options?new oe(n.apple_critical_alert_options):null,S.createdAt=null!==(g=null!==(f=n.created_at)&&void 0!==f?f:n.ts)&&void 0!==g?g:0,S.updatedAt=null!==(_=n.updated_at)&&void 0!==_?_:0,"number"==typeof n.scheduled_message_id&&"number"==typeof n.scheduled_at&&n.scheduled_status&&(S.scheduledInfo={scheduledMessageId:n.scheduled_message_id,scheduledAt:n.scheduled_at},S._scheduledStatus=n.scheduled_status),S.extendedMessage=null!==(T=n.extended_message)&&void 0!==T?T:{},S._isContinuousMessages=null!==(M=n.is_continuous_messages)&&void 0!==M&&M,S}return e(n,t),n.payloadify=function(e){var n,a,i,u;return e?s(r(r({},t.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:ce(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(n=e.mentionedUsers)||void 0===n?void 0:n.map((function(e){return l.payloadify(e)})),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?te.payloadify(e.threadInfo):null,reactions:e.reactions.map((function(e){return ie.payloadify(e)})),sorted_metaarray:null===(a=e.metaArrays)||void 0===a?void 0:a.map((function(e){return re.payloadify(e)})),og_tag:ue.payloadify(e.ogMetaData),silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:oe.payloadify(e.appleCriticalAlertOptions),created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null===(i=e.scheduledInfo)||void 0===i?void 0:i.scheduledMessageId,scheduled_at:null===(u=e.scheduledInfo)||void 0===u?void 0:u.scheduledAt,scheduled_status:e._scheduledStatus,extended_message:e.extendedMessage})):null},n._getParentMessageInfoPayload=function(e){return e?s({type:e.messageType,ts:e.createdAt,user:de.payloadify(e.sender),message:e.message,file:{url:e.plainUrl,name:e.name,type:e.type,require_auth:e.requireAuth}}):null},n.prototype.isIdentical=function(e){return this.messageId===e.messageId},n.prototype.isEqual=function(e){return g(this,e)},n.prototype.isUserMessage=function(){return this.messageType===y.USER},n.prototype.isFileMessage=function(){return this.messageType===y.FILE&&!Object.prototype.hasOwnProperty.call(this,"fileInfoList")},n.prototype.isMultipleFilesMessage=function(){return this.messageType===y.FILE&&Object.prototype.hasOwnProperty.call(this,"fileInfoList")},n.prototype.isAdminMessage=function(){return this.messageType===y.ADMIN},n.prototype.serialize=function(){return _(this)},n.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))},n.prototype.applyThreadInfoUpdateEvent=function(e){return this.messageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},n.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new ie(ie.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},n.prototype.applyParentMessage=function(e){if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1},n}(u),pe=function(t){function n(e,n){var s,a,i,r,l=this;if((l=t.call(this,e,n)||this).sender=null,l.reqId="",l.replyToChannel=!1,l.sendingStatus=null,l.errorCode=0,l.sender=n.user?new de(l._iid,n.user):n.sender_id,l.reqId=null!==(a=null!==(s=n.req_id)&&void 0!==s?s:n.request_id)&&void 0!==a?a:"",l.replyToChannel=null!==(i=n.is_reply_to_channel)&&void 0!==i&&i,n.request_state&&c(T,n.request_state)&&(l.sendingStatus=n.request_state),!l.sendingStatus)if(l.messageId>0)l.sendingStatus=T.SUCCEEDED;else if(l.scheduledInfo)switch(l._scheduledStatus=n.scheduled_status,n.scheduled_status){case se.SENT:case se.IN_QUEUE:l.sendingStatus=T.SUCCEEDED;break;case se.PENDING:l.sendingStatus=T.SCHEDULED;break;case se.FAILED:case se.REMOVED:l.sendingStatus=T.FAILED;break;case se.CANCELED:l.sendingStatus=T.CANCELED}else l.sendingStatus=T.PENDING;return l.errorCode=null!==(r=n.error_code)&&void 0!==r?r:0,l}return e(n,t),n.payloadify=function(e){return e?s(r(r({},t.payloadify.call(this,e)),{user:de.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})):null},Object.defineProperty(n.prototype,"isResendable",{get:function(){return this.sendingStatus===T.FAILED&&M(this.errorCode)},enumerable:!1,configurable:!0}),n.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},n}(he),me=function(){function e(e){var t,n;this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!==(t=e.real_width)&&void 0!==t?t:e.width,this.realHeight=null!==(n=e.real_height)&&void 0!==n?n:e.height}return e.payloadify=function(e){return e?s({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null},Object.defineProperty(e.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),e}(),fe={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:S.ALL,customTypesFilter:null,senderUserIdsFilter:null,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},ge=function(e){return d("number",e.prevResultSize)&&d("number",e.nextResultSize)&&d("boolean",e.isInclusive)&&d("boolean",e.reverse)&&d("string",e.messageTypeFilter)&&c(S,e.messageTypeFilter)&&o("string",e.customTypesFilter,!0)&&o("string",e.senderUserIdsFilter,!0)&&d("boolean",e.includeMetaArray)&&d("boolean",e.includeReactions)&&d("boolean",e.includeParentMessageInfo)},ye=function(t){function n(e,n){var a,i,l,u,o=this;if((o=t.call(this,e,n)||this).message=null,o.translations={},o.message=null!==(a=n.message)&&void 0!==a?a:"",o.messageType=y.ADMIN,o.translations=null!==(i=n.translations)&&void 0!==i?i:{},n.parent_message_info){var d=n.parent_message_info,c=s(r(r({},d),{message_id:o.parentMessageId,channel_url:o.channelUrl,channel_type:o.channelType,file:d.file,url:null===(l=d.file)||void 0===l?void 0:l.url,require_auth:null===(u=d.file)||void 0===u?void 0:u.require_auth}));o.parentMessage=Se(e,c)}return o}return e(n,t),n.payloadify=function(e){return e?s(r(r({},t.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:t._getParentMessageInfoPayload.call(this,e.parentMessage)})):null},n.prototype.getThreadedMessagesByTimestamp=function(e,t){return b(this,void 0,void 0,(function(){var n;return U(this,(function(s){switch(s.label){case 0:return n=r(r({},fe),t),A(this.messageId>0&&d("number",e)&&ge(n)).throw(E.invalidParameters),[4,We.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,s.sent()]}}))}))},n}(he),_e=function(){function e(e){var t,n;this.type=null,this.vendor=null,this.detail={},this.type=null!==(t=e.type)&&void 0!==t?t:"",this.vendor=null!==(n=e.vendor)&&void 0!==n?n:"",e.hasOwnProperty("detail")&&d("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}return e.payloadify=function(e){return e?s({type:e.type,vendor:e.vendor,detail:e.detail}):null},e}(),ve=function(t){function n(e,n){var a,i,l,u,o,d,c,h=this;if((h=t.call(this,e,n)||this).message="",h.messageParams=null,h.translations={},h.translationTargetLanguages=[],h.messageSurvivalSeconds=-1,h.plugins=[],h._poll=null,h.message=n.message,h.messageType=y.USER,h.translations=null!==(l=n.translations)&&void 0!==l?l:{},h.translationTargetLanguages=null!==(u=n.target_langs)&&void 0!==u?u:[],0===Object.keys(h.translations).length&&h.translationTargetLanguages.length>0)try{for(var p=m(h.translationTargetLanguages),f=p.next();!f.done;f=p.next()){var g=f.value;h.translations[g]=""}}catch(e){a={error:e}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(a)throw a.error}}if(h.messageSurvivalSeconds=null!==(o=n.message_survival_seconds)&&void 0!==o?o:-1,h.plugins=n.plugins?n.plugins.map((function(e){return new _e(e)})):[],h._poll=n.poll?new w(h._iid,n.poll):null,n.parent_message_info){var _=n.parent_message_info,v=s(r(r({},_),{created_at:_.ts,message_id:h.parentMessageId,channel_url:h.channelUrl,channel_type:h.channelType,file:_.file,url:null===(d=_.file)||void 0===d?void 0:d.url,require_auth:null===(c=_.file)||void 0===c?void 0:c.require_auth}));h.parentMessage=Se(e,s(v))}return h}return e(n,t),n.payloadify=function(e){return e?s(r(r({},t.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map((function(e){return _e.payloadify(e)})),poll:w.payloadify(e._poll),parent_message_info:t._getParentMessageInfoPayload.call(this,e.parentMessage)})):null},n.prototype.getThreadedMessagesByTimestamp=function(e,t){return b(this,void 0,void 0,(function(){var n;return U(this,(function(s){switch(s.label){case 0:return n=r(r({},fe),t),A(this.messageId>0&&d("number",e)&&ge(n)).throw(E.invalidParameters),[4,We.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,s.sent()]}}))}))},n.prototype.applyPoll=function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)},Object.defineProperty(n.prototype,"poll",{get:function(){return this._poll},enumerable:!1,configurable:!0}),n}(pe),Ie=function(t){function n(e,n){var s,a,i,l,u=this;(u=t.call(this,e)||this).plainUrl="",u.fileName=null,u.mimeType=null,u.fileSize=0,u.thumbnails=[],u._requireAuth=!1,u.plainUrl=n.url,u.fileName=null!==(s=n.file_name)&&void 0!==s?s:null,u.mimeType=null!==(a=n.file_type)&&void 0!==a?a:null,u.fileSize=null!==(i=n.file_size)&&void 0!==i?i:0;var o=F.of(u._iid).sessionManager;return u._requireAuth=null!==(l=n.require_auth)&&void 0!==l&&l,u.thumbnails=n.thumbnails?n.thumbnails.map((function(e){return new me(r(r({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(u._requireAuth?"?auth=".concat(o.ekey):"")}))})):[],u}return e(n,t),n.payloadify=function(e){var t;return{url:e.plainUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(t=e.thumbnails)||void 0===t?void 0:t.map((function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),require_auth:e._requireAuth}},Object.defineProperty(n.prototype,"url",{get:function(){var e=F.of(this._iid).sessionManager;return this._requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),n}(u),Te=function(t){function n(e,n){var s,a,i,l,u,o=this;if((o=t.call(this,e,n)||this).messageParams=null,o.fileInfoList=[],o.messageSurvivalSeconds=-1,o.messageType=y.FILE,o.fileInfoList=null!==(a=null===(s=n.files)||void 0===s?void 0:s.map((function(t){return new Ie(e,t)})))&&void 0!==a?a:[],o.messageSurvivalSeconds=null!==(i=n.message_survival_seconds)&&void 0!==i?i:-1,n.parent_message_info){var d=n.parent_message_info,c=r(r({},d),{message_id:o.parentMessageId,channel_url:o.channelUrl,channel_type:o.channelType,file:d.file,url:null===(l=d.file)||void 0===l?void 0:l.url,require_auth:null===(u=d.file)||void 0===u?void 0:u.require_auth});o.parentMessage=Se(e,c)}return o}return e(n,t),n.prototype.getThreadedMessagesByTimestamp=function(e,t){return b(this,void 0,void 0,(function(){var n;return U(this,(function(s){switch(s.label){case 0:return n=r(r({},fe),t),A(this.messageId>0&&d("number",e)&&ge(n)).throw(E.invalidParameters),[4,We.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,s.sent()]}}))}))},n.payloadify=function(e){return e?s(r(r({},t.payloadify.call(this,e)),{files:e.fileInfoList&&e.fileInfoList&&Array.isArray(e.fileInfoList)?e.fileInfoList.map((function(e){return Ie.payloadify(e)})):void 0,message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:t._getParentMessageInfoPayload.call(this,e.parentMessage)})):null},n._isMultipleFilesMessagePayload=function(e){var t=e.files;return Array.isArray(t)},n._isMultipleFilesMessageSerializedData=function(e){var t=e.fileInfoList;return Array.isArray(t)},n}(pe),Me=function(e){if(e)switch(e.messageType){case y.USER:return ve.payloadify(e);case y.FILE:return be.payloadify(e);case y.ADMIN:return ye.payloadify(e)}return null},Se=function(e,t){switch(t.type){case"MESG":return new ve(e,t);case"FILE":return Te._isMultipleFilesMessagePayload(t)?new Te(e,t):new be(e,t);case"ADMM":case"BRDM":return new ye(e,t)}return null},be=function(t){function n(e,n){var a,i,l,u,o,d,c,h,p,m,f,g,_,v,I,T=this;(T=t.call(this,e,n)||this).messageParams=null,T.plainUrl="",T.requireAuth=!1,T.name=null,T.size=0,T.type=null,T.thumbnails=[],T.messageSurvivalSeconds=-1,T.messageType=y.FILE;var M=null!==(a=n.file)&&void 0!==a?a:null;T.plainUrl=(null!==(l=null!==(i=null==M?void 0:M.url)&&void 0!==i?i:n.url)&&void 0!==l?l:"").split("?auth=")[0],T.name=null!==(o=null!==(u=null==M?void 0:M.name)&&void 0!==u?u:n.name)&&void 0!==o?o:"File",T.size=null!==(c=null!==(d=null==M?void 0:M.size)&&void 0!==d?d:n.size)&&void 0!==c?c:0,T.data=null!==(p=null!==(h=null==M?void 0:M.data)&&void 0!==h?h:n.custom)&&void 0!==p?p:"",T.type=M?null!==(m=M.type)&&void 0!==m?m:"":null!==(f=n.type)&&void 0!==f?f:"";var S=F.of(T._iid).sessionManager;if(T.requireAuth=null!==(g=n.require_auth)&&void 0!==g&&g,T.thumbnails=n.thumbnails?n.thumbnails.map((function(e){return new me(r(r({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(T.requireAuth?"?auth=".concat(S.ekey):"")}))})):[],T.messageSurvivalSeconds=null!==(_=n.message_survival_seconds)&&void 0!==_?_:-1,n.parent_message_info){var b=n.parent_message_info,U=s(r(r({},b),{message_id:T.parentMessageId,channel_url:T.channelUrl,channel_type:T.channelType,file:b.file,url:null===(v=b.file)||void 0===v?void 0:v.url,require_auth:null===(I=b.file)||void 0===I?void 0:I.require_auth}));T.parentMessage=Se(e,U)}return T}return e(n,t),n.payloadify=function(e){var n;return e?s(r(r({},t.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:null===(n=e.thumbnails)||void 0===n?void 0:n.map((function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:t._getParentMessageInfoPayload.call(this,e.parentMessage)})):null},Object.defineProperty(n.prototype,"url",{get:function(){var e=F.of(this._iid).sessionManager;return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),n.prototype.getThreadedMessagesByTimestamp=function(e,t){return b(this,void 0,void 0,(function(){var n;return U(this,(function(s){switch(s.label){case 0:return n=r(r({},fe),t),A(this.messageId>0&&d("number",e)&&ge(n)).throw(E.invalidParameters),[4,We.of(this._iid).getThreadedMessagesByTimestamp(this,e,n)];case 1:return[2,s.sent()]}}))}))},n}(pe),Ue=function(t){function n(e){var n,a,i,r=[];return e.mentionType===I.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map((function(e){return e.userId})))),t.call(this,{code:"FILE",ackRequired:!0,payload:s({channel_url:e.channelUrl,files:Fe(e.files),url:e.url,name:null!==(n=e.fileName)&&void 0!==n?n:"",type:null!==(a=e.mimeType)&&void 0!==a?a:"",size:null!==(i=e.fileSize)&&void 0!==i?i:0,custom:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes,require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:r,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==q.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId>0?e.parentMessageId:null,req_id:e.reqId,pin_message:e.isPinnedMessage})})||this}return e(n,t),n}(D),Ae=function(n){function a(e){var a,i,r=this;r=n.call(this)||this;var l=[];return e.mentionType===I.USERS&&(e.mentionedUserIds?l=e.mentionedUserIds:e.mentionedUsers&&(l=e.mentionedUsers.map((function(e){return e.userId})))),r.method=t.POST,r.path="".concat(P(e.channelType),"/").concat(encodeURIComponent(e.channelUrl),"/messages"),r.params=s({message_type:y.FILE,user_id:e.userId,files:Fe(e.files),url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:l,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:null===(a=e.thumbnailSizes)||void 0===a?void 0:a.map((function(e){return me.payloadify(e)})),require_auth:e.requireAuth,sorted_metaarray:null===(i=e.metaArrays)||void 0===i?void 0:i.map((function(e){return re.payloadify(e)})),push_option:e.pushNotificationDeliveryOption,parent_message_id:e.parentMessageId>0?e.parentMessageId:null,apple_critical_alert_options:oe.payloadify(e.appleCriticalAlertOptions),reply_to_channel:e.isReplyToChannel,req_id:e.reqId,pin_message:e.isPinnedMessage}),r}return e(a,n),a}(a),Ee=function(t){function n(e,n,s){var a,i,r,l=this;(l=t.call(this,e,"FILE",s)||this).message=s.files&&s.files.length>=2?new Te(e,s):new be(e,s);var u=F.of(e).sdkState;return l.isMentioned=N(l.message.mentionType,null!==(a=l.message.mentionedUserIds)&&void 0!==a?a:null===(i=l.message.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),u.userId),l.forceUpdateLastMessage=null!==(r=s.force_update_last_message)&&void 0!==r&&r,l}return e(n,t),n}(C),we=function(t){function n(e,n){var s,a,i=this;(i=t.call(this,e,n)||this).message=n.files&&n.files.length>=2?new Te(e,n):new be(e,n);var r=F.of(e).sdkState;return i.isMentioned=N(i.message.mentionType,null!==(s=i.message.mentionedUserIds)&&void 0!==s?s:i.message.mentionedUsers.map((function(e){return e.userId})),r.userId),i.forceUpdateLastMessage=null!==(a=n.force_update_last_message)&&void 0!==a&&a,i}return e(n,t),n}(i);function Fe(e){return null==e?void 0:e.map((function(e){var t,n;return s({url:e.fileUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(t=e.thumbnailSizes)||void 0===t?void 0:t.map((function(e){return me.payloadify(e)})),require_auth:null===(n=e._uploadedMetaData)||void 0===n?void 0:n.requireAuth})}))}var qe;!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(qe||(qe={}));var De=function(){function e(e,t){var n=t.sdkState,s=t.dispatcher,a=t.requestQueue,i=t.onlineDetector,r=t.cacheContext,l=this;this._queueMap=new Map,this._connectionState=null,this._onlineDetector=null,this._iid=e,this._sdkState=n,this._requestQueue=a,this._cacheContext=r,this._dispatcher=s,this._dispatcher.on((function(e){e instanceof R&&(l._connectionState=e.stateType)})),this._onlineDetector=i}return Object.defineProperty(e.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===O.CONNECTED||this._connectionState===O.CONNECTING||this._connectionState===O.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype._sendFileMessage=function(e,t){return b(this,void 0,void 0,(function(){var n,s,a;return U(this,(function(i){switch(i.label){case 0:return n=this._createSendFileMessageRequestParams(e,t),this._shouldSendThroughWebSocket?(s=new Ue(n),[4,this._requestQueue.send(s)]):[3,2];case 1:return a=i.sent(),[2,a.as(Ee).message];case 2:return s=new Ae(r(r({},n),{userId:this._sdkState.userId})),[4,this._requestQueue.send(s)];case 3:return a=i.sent(),[2,a.as(we).message]}}))}))},e.prototype._createSendFileMessageRequestParams=function(e,t){var n=r(r({},t.params),{channelUrl:e.url,channelType:e.channelType,reqId:t.requestId,url:""});if(t.multipleFileUploadInfo){var s=t.params;n.files=s.fileInfoList}else{s=t.params;n.url=s.fileUrl,n.requireAuth=s.requireAuth}return n},e.prototype._resolveMessageQueue=function(e){return b(this,void 0,void 0,(function(){var t,n,s,a,i,r,l,u,o,d,c,h;return U(this,(function(p){switch(p.label){case 0:if(!(t=this._queueMap.get(e.url)))return[3,21];if(t.isResolving)return[3,20];t.isResolving=!0,n=[],s=!0,p.label=1;case 1:p.trys.push([1,15,16,17]),a=m(t.messageQueue),i=a.next(),p.label=2;case 2:if(i.done)return[3,14];switch(r=i.value,r.state){case qe.PENDING:case qe.UPLOADING:return[3,3];case qe.UPLOADED:return[3,4];case qe.FAILED:return[3,12]}return[3,13];case 3:return s=!1,n.push(r),[3,13];case 4:if(!s)return[3,10];p.label=5;case 5:return p.trys.push([5,8,,9]),r.state=qe.SENDING,[4,this._sendFileMessage(e,r)];case 6:return l=p.sent(),r.deferred.resolve(l),[4,k(100)];case 7:return p.sent(),[3,9];case 8:return u=p.sent(),r.deferred.reject(u),[3,9];case 9:return[3,11];case 10:n.push(r),p.label=11;case 11:return[3,13];case 12:return r.deferred.reject(r.error.code===L.REQUEST_CANCELED?E.fileUploadCanceled:r.error),[3,13];case 13:return i=a.next(),[3,2];case 14:return[3,17];case 15:return o=p.sent(),c={error:o},[3,17];case 16:try{i&&!i.done&&(h=a.return)&&h.call(a)}finally{if(c)throw c.error}return[7];case 17:return d=t.isResolveRequestPending,t.messageQueue=n,t.isResolving=!1,t.isResolveRequestPending=!1,d?[4,this._resolveMessageQueue(e)]:[3,19];case 18:p.sent(),p.label=19;case 19:return[3,21];case 20:t.isResolveRequestPending=!0,p.label=21;case 21:return[2]}}))}))},e.prototype._uploadNextPendingItem=function(e){var t;return b(this,void 0,void 0,(function(){var n,s,a,i,r,l,u,o,d;return U(this,(function(c){switch(c.label){case 0:return n=this._queueMap.get(e.url),(s=n.messageQueue.find((function(e){return e.state===qe.PENDING})))?s.multipleFileUploadInfo?(a=s.multipleFileUploadInfo,i=a.uploadIndex,r=a.uploadCount,l=a.requestHandler,d=s.params,u=d.fileInfoList[i],!z(u.file)||(null===(t=u._uploadedMetaData)||void 0===t?void 0:t.isUploaded)?[3,2]:[4,this._tryUploadNextItemAndUpdateItemState(e,n,s)]):[3,4]:[3,9];case 1:return c.sent(),[3,3];case 2:s.state=i<r-1?qe.PENDING:qe.UPLOADED,c.label=3;case 3:return o=i,null==l||l._triggerOnFileUploaded(s.requestId,o,u,s.error),s.multipleFileUploadInfo.uploadIndex++,[3,7];case 4:return d=s.params,z(d.file)?[4,this._tryUploadNextItemAndUpdateItemState(e,n,s)]:[3,6];case 5:return c.sent(),[3,7];case 6:d.thumbnailSizes=[],s.state=qe.UPLOADED,c.label=7;case 7:return this._uploadNextPendingItem(e),[4,this._resolveMessageQueue(e)];case 8:c.sent(),c.label=9;case 9:return[2]}}))}))},e.prototype._tryUploadNextItemAndUpdateItemState=function(e,t,n){return b(this,void 0,void 0,(function(){var s,a,i,r,l,u;return U(this,(function(o){switch(o.label){case 0:return[4,this._onlineDetector.isOnline()];case 1:if(s=o.sent(),!F.of(this._iid).sessionManager.currentUser&&!s)return n.error=E.connectionRequired,n.state=qe.FAILED,[2];if(!(t.uploadQueue.length<6))return[3,9];n.state=qe.UPLOADING,t.uploadQueue.push(n),o.label=2;case 2:return o.trys.push([2,7,,8]),n.multipleFileUploadInfo?(a=n.multipleFileUploadInfo,i=a.uploadIndex,r=a.uploadCount,l=n.params,[4,this._uploadNextFileForMultipleFilesItemAndUpdateParams(e,n,l)]):[3,4];case 3:return o.sent(),n.state=i<r-1?qe.PENDING:qe.UPLOADED,[3,6];case 4:return l=n.params,[4,this._uploadNextFileForSingleFileItemAndUpdateParams(e,n,l)];case 5:o.sent(),n.state=qe.UPLOADED,o.label=6;case 6:return[3,8];case 7:return u=o.sent(),n.error=u.code===L.REQUEST_FAILED?new E({code:L.NETWORK_ERROR,message:"Failed to upload a file."}):u,n.state=qe.FAILED,[3,8];case 8:this._dequeueUploadItem(t,n),o.label=9;case 9:return[2]}}))}))},e.prototype._dequeueUploadItem=function(e,t){var n=e.uploadQueue.findIndex((function(e){return e.requestId===t.requestId}));n>=0&&e.uploadQueue.splice(n,1)},e.prototype._uploadNextFileForSingleFileItemAndUpdateParams=function(e,t,n){var s,a,i;return b(this,void 0,void 0,(function(){var r,l,u,o,d,c,h,p,m,f;return U(this,(function(g){switch(g.label){case 0:return r=new Y({file:n.file,channelUrl:e.url,thumbnailSizes:n.thumbnailSizes,requestId:t.requestId}),[4,this._requestQueue.send(r)];case 1:return l=g.sent(),u=l.as(ee),o=u.url,d=u.fileSize,c=void 0===d?n.fileSize:d,h=u.thumbnailSizes,p=void 0===h?n.thumbnailSizes:h,m=u.requireAuth,f=void 0!==m&&m,n.fileName=null!==(s=n.fileName)&&void 0!==s?s:n.file.name,n.mimeType=null!==(a=n.mimeType)&&void 0!==a?a:n.file.type,n.fileSize=null!==(i=n.fileSize)&&void 0!==i?i:n.file.size,n.fileUrl=o,n.fileSize=c,n.thumbnailSizes=p,n.requireAuth=f,[2]}}))}))},e.prototype._uploadNextFileForMultipleFilesItemAndUpdateParams=function(e,t,n){var s,a,i;return b(this,void 0,void 0,(function(){var l,u,o,d,c,h,p,m,f,g,y,_;return U(this,(function(v){switch(v.label){case 0:return l=t.multipleFileUploadInfo.uploadIndex,u=n.fileInfoList[l],o=new Y({file:u.file,channelUrl:e.url,thumbnailSizes:u.thumbnailSizes,requestId:t.requestId}),[4,this._requestQueue.send(o)];case 1:return d=v.sent(),c=d.as(ee),h=c.url,p=c.fileSize,m=void 0===p?u.fileSize:p,f=c.thumbnailSizes,g=void 0===f?u.thumbnailSizes:f,y=c.requireAuth,_=void 0!==y&&y,u.fileName=null!==(s=u.fileName)&&void 0!==s?s:u.file.name,u.mimeType=null!==(a=u.mimeType)&&void 0!==a?a:u.file.type,u.fileSize=null!==(i=u.fileSize)&&void 0!==i?i:u.file.size,u.file=null,u.fileUrl=h,u.fileSize=m,u.thumbnailSizes=g,u._uploadedMetaData=r(r({},u._uploadedMetaData),{requireAuth:_,isUploaded:!0}),[2]}}))}))},e.prototype.request=function(e,t,n,s){return void 0===s&&(s=null),b(this,void 0,void 0,(function(){var a,i,r,l,u;return U(this,(function(o){return this._queueMap.has(e.url)||(a={messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1},this._queueMap.set(e.url,a)),i=this._queueMap.get(e.url),r=new x,l={requestId:t,params:n,state:qe.PENDING,deferred:r},function(e){return"fileInfoList"in e}(n)&&(u={uploadIndex:0,uploadCount:n.fileInfoList.length,requestHandler:s},l.multipleFileUploadInfo=u),i.messageQueue.push(l),this._uploadNextPendingItem(e),[2,r.promise]}))}))},e.prototype.cancel=function(e,t){var n,s;void 0===t&&(t=null);var a=this._queueMap.get(e.url);if(a){var i=t?[a.messageQueue.find((function(e){return e.requestId===t}))]:h([],p(a.messageQueue),!1);try{for(var r=m(i),l=r.next();!l.done;l=r.next()){var u=l.value;if(u)switch(u.state){case qe.PENDING:u.state=qe.FAILED,u.error=E.requestCanceled,this._resolveMessageQueue(e);break;case qe.UPLOADING:this._requestQueue.cancel(u.requestId)}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(s=r.return)&&s.call(r)}finally{if(n)throw n.error}}}},e}();var Pe,Ne={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:S.ALL,customTypesFilter:null,senderUserIdsFilter:null,replyType:Q.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},Ce=function(e){return d("number",e.prevResultSize)&&d("number",e.nextResultSize)&&d("boolean",e.isInclusive)&&d("boolean",e.reverse)&&d("string",e.messageTypeFilter)&&c(S,e.messageTypeFilter)&&o("string",e.customTypesFilter,!0)&&o("string",e.senderUserIdsFilter,!0)&&c(Q,e.replyType)&&d("boolean",e.includeMetaArray)&&d("boolean",e.includeReactions)&&d("boolean",e.includeParentMessageInfo)&&d("boolean",e.includeThreadInfo)&&d("boolean",e.showSubchannelMessagesOnly)},Re={replyType:Q.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},Oe=function(e){return c(Q,e.replyType)&&d("boolean",e.includeReactions)&&d("boolean",e.includeMetaArray)&&d("boolean",e.includeParentMessageInfo)&&d("boolean",e.includeThreadInfo)},Le=function(n){function s(e){var s=e.channelType,a=e.channelUrl,i=e.messageId,r=e.includeMetaArray,l=e.includeReactions,u=e.includeThreadInfo,o=e.includeParentMessageInfo,d=n.call(this)||this;return d.method=t.GET,d.path="".concat(P(s),"/").concat(encodeURIComponent(a),"/messages/").concat(encodeURIComponent(i)),d.params={is_sdk:!0,with_sorted_meta_array:r,include_reactions:l,include_thread_info:u,include_parent_message_info:o,include_poll_details:!0},d}return e(s,n),s}(a),ke=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.message=n?Se(e,r({},n)):null,s}return e(n,t),n}(i),ze=function(n){function a(e){var a=e.channelType,i=e.channelUrl,r=e.timestamp,l=void 0===r?null:r,u=e.token,o=void 0===u?null:u,d=e.prevResultSize,c=e.nextResultSize,h=e.isInclusive,p=e.reverse,m=e.messageTypeFilter,f=e.customTypesFilter,g=e.senderUserIdsFilter,y=e.replyType,_=e.includeMetaArray,v=e.includeReactions,I=e.parentMessageId,T=e.includeThreadInfo,M=e.includeParentMessageInfo,S=e.showSubchannelMessagesOnly,b=e.checkingContinuousMessages,U=n.call(this)||this;return U.method=t.GET,U.path="".concat(P(a),"/").concat(encodeURIComponent(i),"/messages"),U.params=s({is_sdk:!0,prev_limit:d,next_limit:c,include:h,reverse:p,message_ts:l,message_id:o,message_type:null!=m?m:null,custom_types:f,sender_ids:g,include_reply_type:y,with_sorted_meta_array:_,include_reactions:v,parent_message_id:I,include_thread_info:T,include_parent_message_info:M,show_subchannel_message_only:S,include_poll_details:!0,checking_continuous_messages:b}),U}return e(a,n),a}(a),xe=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.messages=n.messages.map((function(t){return Se(e,t)})),s}return e(n,t),n}(i),Qe=function(n){function s(e){var s=e.channelType,a=e.channelUrl,i=e.timestamp,r=e.token,l=e.replyType,u=e.includeMetaArray,o=e.includeReactions,d=e.includeThreadInfo,c=e.includeParentMessageInfo,h=n.call(this)||this;return h.method=t.GET,h.path="".concat(P(s),"/").concat(encodeURIComponent(a),"/messages/changelogs"),h.params={change_ts:i,token:r,with_sorted_meta_array:u,include_reactions:o,include_thread_info:d,include_reply_type:l,include_parent_message_info:c,include_poll_details:!0},h}return e(s,n),s}(a),Ge=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.updatedMessages=n.updated.map((function(t){return Se(e,t)})),s.deletedMessagesInfo=n.deleted.map((function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}})),s.hasMore=n.has_more,s.nextToken=n.next,s}return e(n,t),n}(i),Be=function(n){function s(e){var s=e.channelUrl,a=e.scheduledMessageId,i=n.call(this)||this;return i.method=t.GET,i.path="".concat(G,"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(a)),i.params={},i}return e(s,n),s}(a),je=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.message=n?Se(e,r({},n)):null,s}return e(n,t),n}(i),He={},We=function(){function e(e,t){var n=t.sdkState,s=t.dispatcher,a=t.requestQueue,i=t.onlineDetector,r=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=a,this._dispatcher=s,this._cacheContext=r,this.fileMessageQueue=new De(e,{sdkState:n,dispatcher:s,requestQueue:a,onlineDetector:i,cacheContext:r}),He[e]=this}return e.of=function(e){return He[e]},e.prototype.buildMessageFromSerializedData=function(e){var t=B(e);switch(t.messageType){case y.USER:return new ve(this._iid,ve.payloadify(t));case y.FILE:return Te._isMultipleFilesMessageSerializedData(t)?new Te(this._iid,Te.payloadify(t)):new be(this._iid,be.payloadify(t));case y.ADMIN:return new ye(this._iid,ye.payloadify(t))}return null},e.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return s({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations),pollId:e.pollId})},e.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){var n;return s({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.plainUrl,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:null===(n=t.thumbnails)||void 0===n?void 0:n.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),fileType:e.fileType,requireAuth:t.requireAuth})},e.prototype.buildMultipleFilesMessageCreateParamsFromSerializedData=function(e,t){return s({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,fileInfoList:e.fileInfoList})},e.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return r(r({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},e.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return r(r({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},e.prototype.buildSenderFromSerializedData=function(e){var t=B(e);return new de(this._iid,de.payloadify(t))},e.prototype.getMessage=function(e){return b(this,void 0,void 0,(function(){var t,n;return U(this,(function(s){switch(s.label){case 0:return t=new Le(e),[4,this._requestQueue.send(t)];case 1:return n=s.sent(),[2,n.as(ke).message]}}))}))},e.prototype.getScheduledMessage=function(e){return b(this,void 0,void 0,(function(){var t,n;return U(this,(function(s){switch(s.label){case 0:return t=new Be(e),[4,this._requestQueue.send(t)];case 1:return n=s.sent(),[2,n.as(je).message]}}))}))},e.prototype.getMessagesByMessageId=function(e,t,n,s,a){return void 0===a&&(a=j.REQUEST_MESSAGE),b(this,void 0,void 0,(function(){var i,l,u;return U(this,(function(o){switch(o.label){case 0:return i=new ze(r(r({channelType:t,channelUrl:e,token:String(n)},Ne),s)),[4,this._requestQueue.send(i)];case 1:return l=o.sent(),u=l.as(xe).messages,this._dispatcher.dispatch(new H({messages:u,source:a})),[2,u]}}))}))},e.prototype.getMessagesByTimestamp=function(e,t,n,s,a){return void 0===a&&(a=j.REQUEST_MESSAGE),b(this,void 0,void 0,(function(){var i,l,u;return U(this,(function(o){switch(o.label){case 0:return i=new ze(r(r({channelType:t,channelUrl:e,timestamp:n},Ne),s)),[4,this._requestQueue.send(i)];case 1:return l=o.sent(),u=l.as(xe).messages,this._dispatcher.dispatch(new H({messages:u,source:a})),[2,u]}}))}))},e.prototype._getMessagesByTimestampForCollection=function(e,t,n,s,a,i){return void 0===a&&(a=j.REQUEST_MESSAGE),b(this,void 0,void 0,(function(){var l,u,o,d;return U(this,(function(c){switch(c.label){case 0:return l=new ze(r(r(r({channelType:t,channelUrl:e,timestamp:n},Ne),s),{checkingContinuousMessages:i})),[4,this._requestQueue.send(l)];case 1:return u=c.sent(),o=u.payload,d=u.as(xe).messages,this._dispatcher.dispatch(new H({messages:d,source:a})),[2,{messages:d,isContinuousMessages:o}]}}))}))},e.prototype.getThreadedMessagesByTimestamp=function(e,t,n,s){return void 0===s&&(s=j.REQUEST_THREADED_MESSAGE),b(this,void 0,void 0,(function(){var a,i,l,u;return U(this,(function(o){switch(o.label){case 0:return a=new ze(r(r(r({channelUrl:e.channelUrl,channelType:e.channelType,timestamp:t},fe),n),{replyType:Q.ALL,parentMessageId:e.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(a)];case 1:return i=o.sent(),l=i.as(xe).messages,(u=l.slice(1)).forEach((function(t){t.parentMessage=e})),this._dispatcher.dispatch(new H({messages:u,source:s})),[2,{parentMessage:l[0],threadedMessages:u}]}}))}))},e.prototype.getMessageChangelogs=function(e,t,n,a,i){return void 0===i&&(i=j.REQUEST_MESSAGE_CHANGELOGS),b(this,void 0,void 0,(function(){var l,u,o,d,c,h,p,m;return U(this,(function(f){switch(f.label){case 0:return l=new Qe(s(r(r({channelType:t,channelUrl:e,timestamp:"number"==typeof n?n:null,token:"string"==typeof n?n:null},Re),a))),[4,this._requestQueue.send(l)];case 1:return u=f.sent(),o=u.as(Ge),d=o.updatedMessages,c=o.deletedMessagesInfo,h=o.hasMore,p=o.nextToken,m=c.map((function(e){return e.messageId})),d.length>0&&this._dispatcher.dispatch(new H({messages:d,source:i})),m.length>0&&this._dispatcher.dispatch(new W({messageIds:m,source:i})),[2,{updatedMessages:d,deletedMessageIds:m,hasMore:h,token:p}]}}))}))},e}(),Ke=function(){function e(){this._onPending=K,this._onFailed=K,this._onSucceeded=K}return e.prototype._trigger=function(e,t){switch(t.sendingStatus){case T.PENDING:0===t.errorCode&&this._onPending(t);break;case T.FAILED:case T.CANCELED:this._onFailed(e,t.scheduledInfo?null:t);break;case T.SCHEDULED:case T.SUCCEEDED:this._onSucceeded(t)}},e.prototype.onPending=function(e){return this._onPending=e,this},e.prototype.onFailed=function(e){return this._onFailed=e,this},e.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},e}(),Ve=function(t){function n(e,n){var s=t.call(this,e)||this;s.threadInfo=null,s.targetMessageId=0,s.channelUrl=null,s.channelType=null;var a=n.thread_info,i=n.parent_message_id,r=n.channel_url,l=n.channel_type;return a&&d("object",a)&&d("number",i)&&d("string",r)&&d("string",l)&&(s.threadInfo=new te(e,a),s.targetMessageId=i,s.channelUrl=r,s.channelType=l),s}return e(n,t),n}(u),Xe={channelUrl:null,channelType:null,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},Je=function(n){function s(e){var s=e.channelCustomType,a=e.keyword,i=e.limit,r=e.reverse,l=e.exactMatch,u=e.channelUrl,o=e.order,d=e.messageTimestampFrom,c=e.messageTimestampTo,h=e.advancedQuery,p=e.targetFields,m=e.nextToken,f=n.call(this)||this;return f.method=t.GET,f.path="".concat(V,"/messages"),f.params={custom_type:s,query:a,limit:i,reverse:r,exact_match:l,channel_url:u,message_ts_from:d,message_ts_to:c,sort_field:o,advanced_query:h,target_fields:p,after:m},f}return e(s,n),s}(a),Ze=function(t){function n(e,n){var s=t.call(this,e,n)||this;return s.messages=n.results.map((function(t){return Se(e,t)})),s.hasNext=n.has_next,s.nextToken=n.end_cursor,s.totalCount=n.total_count,s}return e(n,t),n}(i);!function(e){e.SCORE="score",e.TIMESTAMP="ts"}(Pe||(Pe={}));var $e=function(t){function n(e,n){var s,a,i,r,l,u,o,d,c,h=this;return(h=t.call(this,e,n)||this).keyword="",h.reverse=!1,h.exactMatch=!1,h.channelUrl="",h.channelCustomType="",h.messageTimestampFrom=null,h.messageTimestampTo=null,h.order=Pe.SCORE,h.advancedQuery=!1,h.targetFields=null,h._nextToken="",h.totalCount=-1,h.keyword=n.keyword,h.reverse=null!==(s=n.reverse)&&void 0!==s&&s,h.exactMatch=null!==(a=n.exactMatch)&&void 0!==a&&a,h.channelUrl=null!==(i=n.channelUrl)&&void 0!==i?i:"",h.channelCustomType=null!==(r=n.channelCustomType)&&void 0!==r?r:"",h.messageTimestampFrom=null!==(l=n.messageTimestampFrom)&&void 0!==l?l:null,h.messageTimestampTo=null!==(u=n.messageTimestampTo)&&void 0!==u?u:null,h.order=null!==(o=n.order)&&void 0!==o?o:Pe.SCORE,h.advancedQuery=null!==(d=n.advancedQuery)&&void 0!==d&&d,h.targetFields=null!==(c=n.targetFields)&&void 0!==c?c:null,h}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&d("string",this.keyword)&&this.keyword.length>0&&d("boolean",this.reverse)&&d("boolean",this.exactMatch)&&d("string",this.channelUrl)&&d("string",this.channelCustomType)&&(d("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(d("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&c(Pe,this.order)&&d("boolean",this.advancedQuery)&&o("string",this.targetFields,!0)},n.prototype.next=function(){return b(this,void 0,void 0,(function(){var e,t,n,s,a,i,l,u;return U(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=F.of(this._iid).requestQueue,t=new Je(r(r({},this),{nextToken:this._nextToken?this._nextToken:null})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=o.sent(),s=n.as(Ze),a=s.messages,i=s.hasNext,l=s.nextToken,u=s.totalCount,this._nextToken=l,this._hasNext=i,this._isLoading=!1,this.totalCount=u,[2,a];case 2:return[2,[]];case 3:throw E.queryInProgress;case 4:return[3,6];case 5:throw E.invalidParameters;case 6:return[2]}}))}))},n}(X),Ye=function(t){function n(e,n,s,a){var i,r,l,u,o,d,c,h,p,m,f=this;return(f=t.call(this,e,n,s,a)||this).reverse=!1,f.messageTypeFilter=S.ALL,f.customTypesFilter=null,f.senderUserIdsFilter=null,f.replyType=Q.NONE,f.includeMetaArray=!1,f.includeReactions=!1,f.includeParentMessageInfo=!1,f.includeThreadInfo=!1,f.showSubchannelMessagesOnly=!1,f._edge=Number.MAX_SAFE_INTEGER,f.reverse=null!==(i=a.reverse)&&void 0!==i&&i,f.messageTypeFilter=null!==(r=a.messageTypeFilter)&&void 0!==r?r:S.ALL,f.customTypesFilter=null!==(l=a.customTypesFilter)&&void 0!==l?l:null,f.senderUserIdsFilter=null!==(u=a.senderUserIdsFilter)&&void 0!==u?u:null,f.replyType=null!==(o=a.replyType)&&void 0!==o?o:Q.NONE,f.includeMetaArray=null!==(d=a.includeMetaArray)&&void 0!==d&&d,f.includeReactions=null!==(c=a.includeReactions)&&void 0!==c&&c,f.includeParentMessageInfo=null!==(h=a.includeParentMessageInfo)&&void 0!==h&&h,f.includeThreadInfo=null!==(p=a.includeThreadInfo)&&void 0!==p&&p,f.showSubchannelMessagesOnly=null!==(m=a.showSubchannelMessagesOnly)&&void 0!==m&&m,f}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&d("boolean",this.reverse)&&c(S,this.messageTypeFilter)&&c(Q,this.replyType)&&o("string",this.customTypesFilter,!0)&&o("string",this.senderUserIdsFilter,!0)&&d("boolean",this.includeMetaArray)&&d("boolean",this.includeReactions)&&d("boolean",this.includeParentMessageInfo)&&d("boolean",this.includeThreadInfo)&&d("boolean",this.showSubchannelMessagesOnly)},n.prototype.load=function(){return b(this,void 0,void 0,(function(){var e;return U(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,We.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly})]):[3,2]:[3,5];case 1:return e=t.sent(),this._edge=Math.min.apply(Math,h([Number.MAX_SAFE_INTEGER],p(e.map((function(e){return e.createdAt}))),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return[2,[]];case 3:throw E.queryInProgress;case 4:return[3,6];case 5:throw E.invalidParameters;case 6:return[2]}}))}))},n}(J),et={channelUrl:null,scheduledMessageId:0},tt=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._onFileUploaded=K,e}return e(n,t),n.prototype._triggerOnFileUploaded=function(e,t,n,s){this._onFileUploaded(e,t,n,s)},n.prototype.onFileUploaded=function(e){return this._onFileUploaded=e,this},n.prototype.onPending=function(e){return t.prototype.onPending.call(this,e),this},n.prototype.onFailed=function(e){return t.prototype.onFailed.call(this,e),this},n.prototype.onSucceeded=function(e){return t.prototype.onSucceeded.call(this,e),this},n}(Ke),nt=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="message",e}return e(n,t),n.prototype.init=function(e,n){var s=n.sdkState,a=n.dispatcher,i=n.sessionManager,r=n.requestQueue,l=n.logger,u=n.onlineDetector,o=n.cacheContext;t.prototype.init.call(this,e,{sdkState:s,dispatcher:a,sessionManager:i,requestQueue:r,logger:l,onlineDetector:u,cacheContext:o}),this._manager=new We(e,{sdkState:s,dispatcher:a,requestQueue:r,onlineDetector:u,cacheContext:o})},n.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},n.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},n.prototype.getMessage=function(e){return b(this,void 0,void 0,(function(){var t;return U(this,(function(n){return t=r(r({},Xe),e),A(function(e){return d("string",e.channelUrl)&&d("string",e.channelType)&&c(v,e.channelType)&&d("number",e.messageId)&&d("boolean",e.includeMetaArray)&&d("boolean",e.includeParentMessageInfo)&&d("boolean",e.includeThreadInfo)}(t)).throw(E.invalidParameters),[2,this._manager.getMessage(t)]}))}))},n.prototype.getScheduledMessage=function(e){return b(this,void 0,void 0,(function(){var t;return U(this,(function(n){return t=r(r({},et),e),A(function(e){return d("string",e.channelUrl)&&d("number",e.scheduledMessageId)}(t)).throw(E.invalidParameters),[2,this._manager.getScheduledMessage(t)]}))}))},n}(Z);export{oe as A,he as B,be as F,se as I,nt as M,le as O,_e as P,ae as R,pe as S,me as T,ve as U,$e as a,Te as b,We as c,re as d,Ye as e,de as f,tt as g,Ke as h,Ne as i,Re as j,Oe as k,ne as l,Ee as m,Me as n,ee as o,Se as p,Y as q,ye as r,Ve as s,Pe as t,ue as u,Ce as v,ie as w,$ as x,te as y,Ie as z};
