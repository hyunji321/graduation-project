{"version":3,"file":"MentionLabel.js","sources":["../../../src/ui/MentionLabel/index.tsx"],"sourcesContent":["import './index.scss';\n\nimport React, {\n  ReactElement,\n  useRef,\n  useState,\n  useCallback,\n} from 'react';\nimport type { User } from '@sendbird/chat';\n\nimport ContextMenu, { MenuItems } from '../ContextMenu';\nimport Label, { LabelTypography, LabelColors } from '../Label';\nimport UserProfile from '../UserProfile';\nimport useSendbirdStateContext from '../../hooks/useSendbirdStateContext';\n\ninterface MentionLabelProps {\n  mentionTemplate: string;\n  mentionedUserId: string;\n  mentionedUserNickname: string;\n  isByMe: boolean;\n}\n\nexport default function MentionLabel(props: MentionLabelProps): JSX.Element {\n  const {\n    mentionTemplate,\n    mentionedUserId,\n    mentionedUserNickname,\n    isByMe,\n  } = props;\n\n  const mentionRef = useRef();\n\n  const sendbirdState = useSendbirdStateContext();\n  const userId = sendbirdState?.config?.userId;\n  const sdk = sendbirdState?.stores?.sdkStore?.sdk;\n  const amIBeingMentioned = userId === mentionedUserId;\n  const [user, setUser] = useState<User| null>();\n  const fetchUser = useCallback(\n    (toggleDropdown) => {\n      if (user || !sdk?.createApplicationUserListQuery) {\n        toggleDropdown();\n        return;\n      }\n      const query = sdk?.createApplicationUserListQuery({\n        userIdsFilter: [mentionedUserId],\n      });\n      query.next().then((members) => {\n        if (members?.length > 0) {\n          setUser(members[0]);\n        }\n        toggleDropdown();\n      });\n    },\n    [sdk, mentionedUserId],\n  );\n  return (\n    <ContextMenu\n      menuTrigger={(toggleDropdown: () => void): ReactElement => (\n        <a\n          className={`\n            sendbird-word__mention\n            ${amIBeingMentioned ? 'sendbird-word__mention--me' : ''}\n          `}\n          onClick={() => fetchUser(toggleDropdown)}\n          ref={mentionRef}\n          data-userid={mentionedUserId}\n          data-nickname={mentionedUserNickname}\n          data-sb-mention={true}\n        >\n          <Label\n            type={LabelTypography.CAPTION_1}\n            color={isByMe ? LabelColors.ONCONTENT_1 : LabelColors.ONBACKGROUND_1}\n          >\n            {`${mentionTemplate}${mentionedUserNickname}`}\n          </Label>\n        </a>\n      )}\n      menuItems={(closeDropdown: () => void): ReactElement => (\n        <MenuItems\n          /**\n          * parentRef: For catching location(x, y) of MenuItems\n          * parentContainRef: For toggling more options(menus & reactions)\n          */\n          parentRef={mentionRef}\n          parentContainRef={mentionRef}\n          closeDropdown={closeDropdown}\n          style={{ paddingTop: '0px', paddingBottom: '0px' }}\n        >\n          <UserProfile\n            user={user}\n            onSuccess={closeDropdown}\n            currentUserId={userId}\n          />\n        </MenuItems>\n      )}\n    />\n  );\n}\n"],"names":["MentionLabel","props","_sendbirdState$config","_sendbirdState$stores","_sendbirdState$stores2","mentionTemplate","mentionedUserId","mentionedUserNickname","isByMe","mentionRef","useRef","sendbirdState","useSendbirdStateContext","userId","config","sdk","stores","sdkStore","amIBeingMentioned","user","setUser","useState","fetchUser","useCallback","toggleDropdown","createApplicationUserListQuery","query","userIdsFilter","next","then","members","length","React","createElement","ContextMenu","menuTrigger","className","onClick","ref","Label","type","LabelTypography","CAPTION_1","color","LabelColors","ONCONTENT_1","ONBACKGROUND_1","menuItems","closeDropdown","MenuItems","parentRef","parentContainRef","style","paddingTop","paddingBottom","UserProfile","onSuccess","currentUserId"],"mappings":"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"}