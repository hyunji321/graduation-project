{"version":3,"file":"MessageSearchUI.js","sources":["../../../../src/modules/MessageSearch/components/MessageSearchUI/index.tsx"],"sourcesContent":["import React, { useContext } from 'react';\nimport type { FileMessage, UserMessage } from '@sendbird/chat/message';\nimport './index.scss';\n\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport { useMessageSearchContext } from '../../context/MessageSearchProvider';\n\nimport MessageSearchItem from '../../../../ui/MessageSearchItem';\nimport PlaceHolder, { PlaceHolderTypes } from '../../../../ui/PlaceHolder';\nimport MessageSearchFileItem from '../../../../ui/MessageSearchFileItem';\nimport { ClientSentMessages } from '../../../../types';\n\nconst COMPONENT_CLASS_NAME = 'sendbird-message-search';\n\nexport interface MessageSearchUIProps {\n  renderPlaceHolderError?: (props: void) => React.ReactElement;\n  renderPlaceHolderLoading?: (props: void) => React.ReactElement;\n  renderPlaceHolderNoString?: (props: void) => React.ReactElement;\n  renderPlaceHolderEmptyList?: (props: void) => React.ReactElement;\n  renderSearchItem?(\n    {\n      message,\n      onResultClick,\n    }: {\n      message: ClientSentMessages,\n      onResultClick?: (message: ClientSentMessages) => void,\n    }\n  ): JSX.Element;\n}\n\nexport const MessageSearchUI: React.FC<MessageSearchUIProps> = ({\n  renderPlaceHolderError,\n  renderPlaceHolderLoading,\n  renderPlaceHolderNoString,\n  renderPlaceHolderEmptyList,\n  renderSearchItem,\n}: MessageSearchUIProps) => {\n  const {\n    isInvalid,\n    searchString,\n    requestString,\n    currentChannel,\n    retryCount,\n    setRetryCount,\n    loading,\n    scrollRef,\n    hasMoreResult,\n    onScroll,\n    allMessages,\n    onResultClick,\n    selectedMessageId,\n    setSelectedMessageId,\n  } = useMessageSearchContext();\n\n  const { stringSet } = useContext(LocalizationContext);\n\n  const handleRetryToConnect = () => {\n    setRetryCount(retryCount + 1);\n  };\n\n  const handleOnScroll = (e) => {\n    const scrollElement = e.target;\n    const {\n      scrollTop,\n      scrollHeight,\n      clientHeight,\n    } = scrollElement;\n\n    if (!hasMoreResult) {\n      return;\n    }\n    if (scrollTop + clientHeight >= scrollHeight - 1) {\n      onScroll(() => {\n        // after load more searched messages\n      });\n    }\n  };\n\n  const getChannelName = () => {\n    if (currentChannel && currentChannel?.name && currentChannel?.name !== 'Group Channel') {\n      return currentChannel?.name;\n    }\n    if (currentChannel && (currentChannel?.name === 'Group Channel' || !currentChannel?.name)) {\n      return currentChannel.members.map((member) => member.nickname || stringSet.NO_NAME).join(', ');\n    }\n    return stringSet.NO_TITLE;\n  };\n\n  if (isInvalid && searchString && requestString) {\n    return renderPlaceHolderError?.() || (\n      <div className={COMPONENT_CLASS_NAME}>\n        <PlaceHolder\n          type={PlaceHolderTypes.WRONG}\n          retryToConnect={handleRetryToConnect}\n        />\n      </div>\n    );\n  }\n\n  if (loading && searchString && requestString) {\n    return renderPlaceHolderLoading?.() || (\n      <div className={COMPONENT_CLASS_NAME}>\n        <PlaceHolder type={PlaceHolderTypes.SEARCHING} />\n      </div>\n    );\n  }\n\n  if (!searchString) {\n    return renderPlaceHolderNoString?.() || (\n      <div className={COMPONENT_CLASS_NAME}>\n        <PlaceHolder\n          type={PlaceHolderTypes.SEARCH_IN}\n          searchInString={getChannelName()}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className={COMPONENT_CLASS_NAME}\n      onScroll={handleOnScroll}\n      ref={scrollRef}\n    >\n      {\n        (allMessages.length > 0)\n          ? (\n            allMessages.map((message) => {\n              if (renderSearchItem) {\n                return renderSearchItem({ message, onResultClick });\n              }\n              if (message.messageType === 'file') {\n                return (\n                  <MessageSearchFileItem\n                    className={`${COMPONENT_CLASS_NAME}__message-search-item`}\n                    message={message as FileMessage}\n                    key={message.messageId}\n                    selected={(selectedMessageId === message.messageId)}\n                    onClick={() => {\n                      onResultClick(message);\n                      setSelectedMessageId(message.messageId);\n                    }}\n                  />\n                );\n              }\n              return (\n                <MessageSearchItem\n                  className={`${COMPONENT_CLASS_NAME}__message-search-item`}\n                  message={message as UserMessage}\n                  key={message.messageId}\n                  selected={(selectedMessageId === message.messageId)}\n                  onClick={() => {\n                    onResultClick(message);\n                    setSelectedMessageId(message.messageId);\n                  }}\n                />\n              );\n            })\n          )\n          : renderPlaceHolderEmptyList?.() || (\n            <PlaceHolder type={PlaceHolderTypes.NO_RESULTS} />\n          )\n      }\n    </div>\n  );\n};\n\nexport default MessageSearchUI;\n"],"names":["COMPONENT_CLASS_NAME","MessageSearchUI","_ref","renderPlaceHolderError","renderPlaceHolderLoading","renderPlaceHolderNoString","renderPlaceHolderEmptyList","renderSearchItem","isInvalid","searchString","requestString","currentChannel","retryCount","setRetryCount","loading","scrollRef","hasMoreResult","onScroll","allMessages","onResultClick","selectedMessageId","setSelectedMessageId","useMessageSearchContext","stringSet","useContext","LocalizationContext","handleRetryToConnect","handleOnScroll","e","scrollElement","target","scrollTop","scrollHeight","clientHeight","getChannelName","name","members","map","member","nickname","NO_NAME","join","NO_TITLE","React","createElement","className","PlaceHolder","type","PlaceHolderTypes","WRONG","retryToConnect","SEARCHING","SEARCH_IN","searchInString","ref","length","message","messageType","MessageSearchFileItem","key","messageId","selected","onClick","MessageSearchItem","NO_RESULTS"],"mappings":"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"}