{"version":3,"file":"InviteUsers.js","sources":["../../../src/modules/CreateChannel/components/InviteUsers/utils.ts","../../../src/modules/CreateChannel/components/InviteUsers/index.tsx"],"sourcesContent":["import type { ApplicationUserListQuery } from '@sendbird/chat';\nimport type { GroupChannelCreateParams, SendbirdGroupChat } from '@sendbird/chat/groupChannel';\nimport { CHANNEL_TYPE } from '../../types';\n\nexport const filterUser = (idsToFilter: string[]) => (currentId: string): boolean => idsToFilter?.includes(currentId);\n\nexport const setChannelType = (\n  params: GroupChannelCreateParams,\n  type: CHANNEL_TYPE,\n): GroupChannelCreateParams => {\n  if (type === 'broadcast') {\n    // eslint-disable-next-line no-param-reassign\n    params.isBroadcast = true;\n  }\n  if (type === 'supergroup') {\n    // eslint-disable-next-line no-param-reassign\n    params.isSuper = true;\n  }\n  return params;\n};\n\ntype CreateDefaultUserListQueryType = {\n  sdk: SendbirdGroupChat;\n  userFilledApplicationUserListQuery?: ApplicationUserListQuery;\n};\n\nexport const createDefaultUserListQuery = (\n  { sdk, userFilledApplicationUserListQuery }: CreateDefaultUserListQueryType,\n): ApplicationUserListQuery => {\n  if (sdk?.createApplicationUserListQuery) {\n    const params = sdk?.createApplicationUserListQuery();\n    if (userFilledApplicationUserListQuery) {\n      Object.keys(userFilledApplicationUserListQuery).forEach((key) => {\n        params[key] = userFilledApplicationUserListQuery[key];\n      });\n    }\n    return params;\n  }\n};\n","import React, { useState, useEffect, useContext } from 'react';\nimport type { ApplicationUserListQuery, User } from '@sendbird/chat';\n\nimport './invite-users.scss';\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport { useCreateChannelContext, UserListQuery } from '../../context/CreateChannelProvider';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport type { GroupChannelCreateParams, SendbirdGroupChat } from '@sendbird/chat/groupChannel';\n\nimport Modal from '../../../../ui/Modal';\nimport Label, {\n  LabelColors,\n  LabelTypography,\n} from '../../../../ui/Label';\nimport { ButtonTypes } from '../../../../ui/Button';\nimport UserListItem from '../../../../ui/UserListItem';\n\nimport {\n  filterUser,\n  setChannelType,\n  createDefaultUserListQuery,\n} from './utils';\n\nexport interface InviteUsersProps {\n  onCancel?: () => void;\n  userListQuery?(): UserListQuery;\n}\n\nconst appHeight = () => {\n  try {\n    const doc = document.documentElement;\n    doc.style.setProperty('--sendbird-vh', (window.innerHeight * 0.01) + 'px');\n  } catch {\n    //\n  }\n};\n\nconst BUFFER = 50;\n\nconst InviteUsers: React.FC<InviteUsersProps> = ({\n  onCancel,\n  userListQuery,\n}: InviteUsersProps) => {\n  const {\n    onBeforeCreateChannel,\n    onCreateChannel,\n    overrideInviteUser,\n    createChannel,\n    type,\n  } = useCreateChannelContext();\n\n  const globalStore = useSendbirdStateContext();\n  const userId = globalStore?.config?.userId;\n  const sdk = globalStore?.stores?.sdkStore?.sdk as SendbirdGroupChat;\n  const idsToFilter = [userId];\n  const [users, setUsers] = useState<User[]>([]);\n  const [selectedUsers, setSelectedUsers] = useState({});\n  const { stringSet } = useContext(LocalizationContext);\n  const [usersDataSource, setUsersDataSource] = useState<ApplicationUserListQuery | UserListQuery>(null);\n  const selectedCount = Object.keys(selectedUsers).length;\n  const titleText = stringSet.MODAL__CREATE_CHANNEL__TITLE;\n  const submitText = stringSet.BUTTON__CREATE;\n\n  const userQueryCreator = userListQuery ? userListQuery() : createDefaultUserListQuery({ sdk });\n\n  useEffect(() => {\n    const applicationUserListQuery = userQueryCreator;\n    setUsersDataSource(applicationUserListQuery);\n    // @ts-ignore\n    if (!applicationUserListQuery?.isLoading) {\n      applicationUserListQuery.next().then((users_) => {\n        setUsers(users_);\n      });\n    }\n  }, []);\n\n  // https://stackoverflow.com/a/70302463\n  // https://css-tricks.com/the-trick-to-viewport-units-on-mobile/#css-custom-properties-the-trick-to-correct-sizing\n  // to fix navbar break in mobile\n  useEffect(() => {\n    appHeight();\n    window.addEventListener('resize', appHeight);\n    return () => {\n      window.removeEventListener('resize', appHeight);\n    };\n  }, []);\n\n  return (\n    <Modal\n      isFullScreenOnMobile\n      titleText={titleText}\n      submitText={submitText}\n      type={ButtonTypes.PRIMARY}\n      disabled={Object.keys(selectedUsers).length === 0}\n      onCancel={onCancel}\n      onSubmit={() => {\n        const selectedUserList = Object.keys(selectedUsers);\n        if (typeof overrideInviteUser === 'function') {\n          overrideInviteUser({\n            users: selectedUserList,\n            onClose: onCancel,\n            channelType: type,\n          });\n          return;\n        }\n        if (selectedUserList.length > 0) {\n          if (onBeforeCreateChannel) {\n            const params = onBeforeCreateChannel(selectedUserList);\n            setChannelType(params, type);\n            createChannel(params).then((channel) => {\n              onCreateChannel(channel);\n            });\n          } else {\n            const params: GroupChannelCreateParams = {};\n            params.invitedUserIds = selectedUserList;\n            params.isDistinct = false;\n            if (userId) {\n              params.operatorUserIds = [userId];\n            }\n            setChannelType(params, type);\n            // do not have custom params\n            createChannel(params).then((channel) => {\n              onCreateChannel(channel);\n            });\n          }\n          onCancel();\n        }\n      }}\n    >\n      <div>\n        <Label\n          color={(selectedCount > 0) ? LabelColors.PRIMARY : LabelColors.ONBACKGROUND_3}\n          type={LabelTypography.CAPTION_1}\n        >\n          {`${selectedCount} ${stringSet.MODAL__INVITE_MEMBER__SELECTED}`}\n        </Label>\n        <div\n          className=\"sendbird-create-channel--scroll\"\n\n          onScroll={(e) => {\n            const eventTarget = e.target as HTMLDivElement;\n            const { hasNext } = usersDataSource;\n            const fetchMore = (\n              (eventTarget.clientHeight + eventTarget.scrollTop + BUFFER) > eventTarget.scrollHeight\n            );\n\n            if (hasNext && fetchMore) {\n              usersDataSource.next().then((usersBatch) => {\n                setUsers([\n                  ...users,\n                  ...usersBatch,\n                ]);\n              });\n            }\n          }}\n        >\n          {\n            users.map((user) => (!filterUser(idsToFilter)(user.userId)) && (\n              <UserListItem\n                key={user.userId}\n                user={user}\n                checkBox\n                checked={selectedUsers[user.userId]}\n                onChange={\n                  (event) => {\n                    const modifiedSelectedUsers = {\n                      ...selectedUsers,\n                      [event.target.id]: event.target.checked,\n                    };\n                    if (!event.target.checked) {\n                      delete modifiedSelectedUsers[event.target.id];\n                    }\n                    setSelectedUsers(modifiedSelectedUsers);\n                  }\n                }\n              />\n            ))\n          }\n        </div>\n      </div>\n    </Modal>\n  );\n};\n\nexport default InviteUsers;\n"],"names":["filterUser","idsToFilter","currentId","includes","setChannelType","params","type","isBroadcast","isSuper","createDefaultUserListQuery","_ref","sdk","userFilledApplicationUserListQuery","createApplicationUserListQuery","Object","keys","forEach","key","appHeight","doc","document","documentElement","style","setProperty","window","innerHeight","_unused","BUFFER","InviteUsers","_globalStore$config","_globalStore$stores","_globalStore$stores$s","onCancel","userListQuery","onBeforeCreateChannel","onCreateChannel","overrideInviteUser","createChannel","useCreateChannelContext","globalStore","useSendbirdStateContext","userId","config","stores","sdkStore","users","setUsers","useState","selectedUsers","setSelectedUsers","stringSet","useContext","LocalizationContext","usersDataSource","setUsersDataSource","selectedCount","length","titleText","MODAL__CREATE_CHANNEL__TITLE","submitText","BUTTON__CREATE","userQueryCreator","useEffect","applicationUserListQuery","isLoading","next","then","users_","addEventListener","removeEventListener","React","createElement","Modal","isFullScreenOnMobile","ButtonTypes","PRIMARY","disabled","onSubmit","selectedUserList","onClose","channelType","channel","invitedUserIds","isDistinct","operatorUserIds","Label","color","LabelColors","ONBACKGROUND_3","LabelTypography","CAPTION_1","MODAL__INVITE_MEMBER__SELECTED","className","onScroll","e","eventTarget","target","hasNext","fetchMore","clientHeight","scrollTop","scrollHeight","usersBatch","map","user","UserListItem","checkBox","checked","onChange","event","modifiedSelectedUsers","_objectSpread","id"],"mappings":"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"}