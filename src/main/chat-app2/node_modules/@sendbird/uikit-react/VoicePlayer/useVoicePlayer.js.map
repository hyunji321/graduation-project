{"version":3,"file":"useVoicePlayer.js","sources":["../../src/hooks/VoicePlayer/utils.ts","../../src/hooks/VoicePlayer/useVoicePlayer.tsx"],"sourcesContent":["export type GroupKey = string;\nexport const generateGroupKey = (channelUrl = '', key = ''): GroupKey => (`${channelUrl}-${key}`);\n","import { useEffect, useState } from 'react';\nimport { useVoicePlayerContext } from '.';\nimport { VOICE_PLAYER_AUDIO_ID } from '../../utils/consts';\nimport { useVoiceRecorderContext } from '../VoiceRecorder';\n\nimport { AudioUnitDefaultValue, VoicePlayerStatusType } from './dux/initialState';\nimport { generateGroupKey } from './utils';\n\nexport interface UseVoicePlayerProps {\n  key: string;\n  channelUrl: string;\n  audioFile?: File;\n  audioFileUrl?: string;\n}\n\nexport interface UseVoicePlayerContext {\n  play: () => void;\n  pause: () => void;\n  stop: (text?: string) => void;\n  playbackTime: number;\n  duration: number;\n  playingStatus: VoicePlayerStatusType;\n}\n\nexport const useVoicePlayer = ({\n  key = '',\n  channelUrl = '',\n  audioFile = null,\n  audioFileUrl = '',\n}: UseVoicePlayerProps): UseVoicePlayerContext => {\n  const [groupKey] = useState<string>(generateGroupKey(channelUrl, key));\n  const {\n    play,\n    pause,\n    stop,\n    voicePlayerStore,\n  } = useVoicePlayerContext();\n  const { isRecordable } = useVoiceRecorderContext();\n  const currentAudioUnit = voicePlayerStore?.audioStorage?.[groupKey] || AudioUnitDefaultValue();\n\n  const playVoicePlayer = () => {\n    if (!isRecordable) {\n      play?.({\n        groupKey,\n        audioFile,\n        audioFileUrl,\n      });\n    }\n  };\n\n  const pauseVoicePlayer = () => {\n    pause?.(groupKey);\n  };\n\n  const stopVoicePlayer = (text = '') => {\n    stop?.(text);\n  };\n\n  useEffect(() => {\n    return () => {\n      if (audioFile || audioFileUrl) {\n        // Can't get the current AudioPlayer through the React hooks(useReducer or useState) in this scope\n        const voiceAudioPlayerElement = document.getElementById(VOICE_PLAYER_AUDIO_ID);\n        (voiceAudioPlayerElement as HTMLAudioElement)?.pause?.();\n      }\n    };\n  }, []);\n\n  return ({\n    play: playVoicePlayer,\n    pause: pauseVoicePlayer,\n    stop: stopVoicePlayer,\n    playbackTime: currentAudioUnit.playbackTime * 1000,\n    duration: currentAudioUnit.duration * 1000,\n    // the unit of playbackTime and duration should be millisecond\n    playingStatus: currentAudioUnit.playingStatus,\n  });\n};\n"],"names":["generateGroupKey","channelUrl","arguments","length","undefined","key","useVoicePlayer","_ref","_voicePlayerStore$aud","audioFile","audioFileUrl","groupKey","useState","play","pause","stop","voicePlayerStore","useVoicePlayerContext","isRecordable","useVoiceRecorderContext","currentAudioUnit","audioStorage","AudioUnitDefaultValue","playVoicePlayer","pauseVoicePlayer","stopVoicePlayer","text","useEffect","_pause","_ref2","voiceAudioPlayerElement","document","getElementById","VOICE_PLAYER_AUDIO_ID","call","playbackTime","duration","playingStatus"],"mappings":"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"}