{"version":3,"file":"MessageList.js","sources":["../../../src/modules/Channel/components/MessageList/getMessagePartsInfo.ts","../../../src/modules/Channel/components/MessageList/hooks/useSetScrollToBottom.ts","../../../src/modules/Channel/components/MessageList/index.tsx"],"sourcesContent":["import { GroupChannel } from '@sendbird/chat/groupChannel';\nimport { AdminMessage, FileMessage, UserMessage } from '@sendbird/chat/message';\nimport isSameDay from 'date-fns/isSameDay';\n\nimport { compareMessagesForGrouping } from '../../context/utils';\n\nexport interface GetMessagePartsInfoProps {\n  allMessages: Array<UserMessage | FileMessage | AdminMessage>;\n  isMessageGroupingEnabled: boolean;\n  currentIndex: number;\n  currentMessage: UserMessage | FileMessage | AdminMessage;\n  currentChannel: GroupChannel;\n  replyType: string;\n}\n\ninterface OutPuts {\n  chainTop: boolean,\n  chainBottom: boolean,\n  hasSeparator: boolean,\n}\n\nexport const getMessagePartsInfo = ({\n  allMessages = [],\n  isMessageGroupingEnabled = true,\n  currentIndex = 0,\n  currentMessage = null,\n  currentChannel = null,\n  replyType = '',\n}: GetMessagePartsInfoProps): OutPuts => {\n  const previousMessage = allMessages[currentIndex - 1];\n  const nextMessage = allMessages[currentIndex + 1];\n  const [chainTop, chainBottom] = isMessageGroupingEnabled\n    ? compareMessagesForGrouping(previousMessage, currentMessage, nextMessage, currentChannel, replyType)\n    : [false, false];\n  const previousMessageCreatedAt = previousMessage?.createdAt;\n  const currentCreatedAt = currentMessage.createdAt;\n  // https://stackoverflow.com/a/41855608\n  const hasSeparator = !(previousMessageCreatedAt && (\n    isSameDay(currentCreatedAt, previousMessageCreatedAt)\n  ));\n  return {\n    chainTop,\n    chainBottom,\n    hasSeparator,\n  };\n};\n","import React, { useState } from 'react';\nimport { useDebounce } from '../../../../../hooks/useDebounce';\n\nconst DELAY = 500;\n\nexport function useSetScrollToBottom(): ({\n  scrollBottom: number;\n  scrollToBottomHandler: (e: React.UIEvent<HTMLDivElement, UIEvent>) => void;\n}) {\n  const [scrollBottom, setScrollBottom] = useState(0);\n  const scrollCb = (e: React.UIEvent<HTMLDivElement, UIEvent>) => {\n    const element = e.target as HTMLDivElement;\n    try {\n      setScrollBottom(element.scrollHeight - element.scrollTop - element.offsetHeight);\n    } catch {\n      //\n    }\n  };\n  return {\n    scrollBottom,\n    scrollToBottomHandler: useDebounce(scrollCb, DELAY),\n  };\n}\n","import './message-list.scss';\n\nimport React from 'react';\n\nimport { useChannelContext } from '../../context/ChannelProvider';\nimport PlaceHolder, { PlaceHolderTypes } from '../../../../ui/PlaceHolder';\nimport Icon, { IconTypes, IconColors } from '../../../../ui/Icon';\nimport Message from '../Message';\nimport { EveryMessage, RenderCustomSeparatorProps, RenderMessageProps } from '../../../../types';\nimport { isAboutSame } from '../../context/utils';\nimport { getMessagePartsInfo } from './getMessagePartsInfo';\nimport UnreadCount from '../UnreadCount';\nimport FrozenNotification from '../FrozenNotification';\nimport { SCROLL_BUFFER } from '../../../../utils/consts';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport { UserMessage } from '@sendbird/chat/message';\nimport { MessageProvider } from '../../../Message/context/MessageProvider';\nimport { useHandleOnScrollCallback } from '../../../../hooks/useHandleOnScrollCallback';\nimport { useSetScrollToBottom } from './hooks/useSetScrollToBottom';\n\nconst SCROLL_BOTTOM_PADDING = 50;\n\nexport interface MessageListProps {\n  className?: string;\n  renderMessage?: (props: RenderMessageProps) => React.ReactElement;\n  renderPlaceholderEmpty?: () => React.ReactElement;\n  renderCustomSeparator?: (props: RenderCustomSeparatorProps) => React.ReactElement;\n  renderPlaceholderLoader?: () => React.ReactElement;\n}\n\nconst MessageList: React.FC<MessageListProps> = ({\n  className = '',\n  renderMessage,\n  renderPlaceholderEmpty,\n  renderCustomSeparator,\n  renderPlaceholderLoader,\n}) => {\n  const {\n    allMessages,\n    hasMorePrev,\n    hasMoreNext,\n    setInitialTimeStamp,\n    setAnimatedMessageId,\n    setHighLightedMessageId,\n    isMessageGroupingEnabled,\n    scrollRef,\n    onScrollCallback,\n    onScrollDownCallback,\n    messagesDispatcher,\n    messageActionTypes,\n    currentGroupChannel,\n    disableMarkAsRead,\n    filterMessageList,\n    replyType,\n    loading,\n    unreadSince,\n  } = useChannelContext();\n  const store = useSendbirdStateContext();\n  const allMessagesFiltered = (typeof filterMessageList === 'function')\n    ? allMessages.filter((filterMessageList as (message: EveryMessage) => boolean))\n    : allMessages;\n  const markAsReadScheduler = store.config.markAsReadScheduler;\n\n  const onScroll = () => {\n    const element = scrollRef?.current;\n    if (element == null) {\n      return;\n    }\n\n    const {\n      scrollTop,\n      clientHeight,\n      scrollHeight,\n    } = element;\n\n    if (isAboutSame(scrollTop, 0, SCROLL_BUFFER)) {\n      onScrollCallback((messages) => {\n        if (messages) {\n          try {\n            //\n          } catch (error) {\n            //\n          }\n        }\n      });\n    }\n\n    if (isAboutSame(clientHeight + scrollTop, scrollHeight, SCROLL_BUFFER) && hasMoreNext) {\n      onScrollDownCallback(([messages]) => {\n        if (messages) {\n          try {\n            // element.scrollTop = scrollHeight - clientHeight;\n            // scrollRef.current.scrollTop = scrollHeight - clientHeight;\n          } catch (error) {\n            //\n          }\n        }\n      });\n    }\n\n    if (!disableMarkAsRead\n      && isAboutSame(clientHeight + scrollTop, scrollHeight, SCROLL_BUFFER)\n      && !!currentGroupChannel\n    ) {\n      messagesDispatcher({\n        type: messageActionTypes.MARK_AS_READ,\n        payload: { channel: currentGroupChannel },\n      });\n      markAsReadScheduler.push(currentGroupChannel);\n    }\n  };\n\n  const onClickScrollBot = () => {\n    setInitialTimeStamp?.(null);\n    setAnimatedMessageId?.(null);\n    setHighLightedMessageId?.(null);\n    if (scrollRef?.current?.scrollTop > -1) {\n      scrollRef.current.scrollTop = (scrollRef?.current?.scrollHeight ?? 0) - (scrollRef?.current?.offsetHeight ?? 0);\n    }\n  };\n\n  // Move the messsage list scroll when the last message's height is changed by reactions\n  const handleMessageHeightChange = () => {\n    const current = scrollRef?.current;\n    if (current) {\n      const bottom = current.scrollHeight - current.scrollTop - current.offsetHeight;\n      if (scrollBottom < bottom && scrollBottom <= SCROLL_BUFFER) {\n        current.scrollTop += bottom - scrollBottom;\n      }\n    }\n  };\n  // Keep the scrollBottom value after fetching new message list\n  const handleMessageListHeightChange = () => {\n    const current = scrollRef?.current;\n    if (current) {\n      const bottom = current.scrollHeight - current.scrollTop - current.offsetHeight;\n      if (scrollBottom < bottom) {\n        current.scrollTop += bottom - scrollBottom;\n      }\n    }\n  };\n\n  const handleOnScroll = useHandleOnScrollCallback({\n    hasMore: hasMorePrev,\n    hasNext: hasMoreNext,\n    onScroll,\n    scrollRef,\n  });\n\n  const { scrollToBottomHandler, scrollBottom } = useSetScrollToBottom();\n\n  if (loading) {\n    return (typeof renderPlaceholderLoader === 'function')\n      ? renderPlaceholderLoader()\n      : <PlaceHolder type={PlaceHolderTypes.LOADING} />;\n  }\n  if (allMessagesFiltered.length < 1) {\n    if (renderPlaceholderEmpty && typeof renderPlaceholderEmpty === 'function') {\n      return renderPlaceholderEmpty();\n    }\n    return <PlaceHolder className=\"sendbird-conversation__no-messages\" type={PlaceHolderTypes.NO_MESSAGES} />;\n  }\n  return (\n    <div className={`sendbird-conversation__messages ${className}`}>\n      <div className=\"sendbird-conversation__scroll-container\">\n        <div className=\"sendbird-conversation__padding\" />\n        <div\n          className=\"sendbird-conversation__messages-padding\"\n          ref={scrollRef}\n          onScroll={(e) => {\n            handleOnScroll();\n            scrollToBottomHandler(e);\n          }}\n        >\n          {allMessagesFiltered.map((m, idx) => {\n            const {\n              chainTop,\n              chainBottom,\n              hasSeparator,\n            } = getMessagePartsInfo({\n              allMessages: allMessagesFiltered,\n              replyType,\n              isMessageGroupingEnabled,\n              currentIndex: idx,\n              currentMessage: m,\n              currentChannel: currentGroupChannel,\n            });\n            const isByMe = (m as UserMessage)?.sender?.userId === store?.config?.userId;\n            return (\n              <MessageProvider message={m} key={m?.messageId} isByMe={isByMe}>\n                <Message\n                  handleScroll={handleMessageHeightChange}\n                  handleMessageListHeightChange={handleMessageListHeightChange}\n                  renderMessage={renderMessage}\n                  message={m}\n                  hasSeparator={hasSeparator}\n                  chainTop={chainTop}\n                  chainBottom={chainBottom}\n                  renderCustomSeparator={renderCustomSeparator}\n                />\n              </MessageProvider>\n            );\n          })}\n          {/* show frozen notifications */}\n          {/* show new message notifications */}\n        </div>\n      </div>\n      {currentGroupChannel?.isFrozen && (\n        <FrozenNotification className=\"sendbird-conversation__messages__notification\" />\n      )}\n      <UnreadCount\n        className=\"sendbird-conversation__messages__notification\"\n        count={currentGroupChannel?.unreadMessageCount}\n        time={unreadSince}\n        onClick={() => {\n          if (scrollRef?.current?.scrollTop) {\n            scrollRef.current.scrollTop = (scrollRef?.current?.scrollHeight ?? 0) - (scrollRef?.current?.offsetHeight ?? 0);\n          }\n          if (!disableMarkAsRead && !!currentGroupChannel) {\n            markAsReadScheduler.push(currentGroupChannel);\n            messagesDispatcher({\n              type: messageActionTypes.MARK_AS_READ,\n              payload: { channel: currentGroupChannel },\n            });\n          }\n          setInitialTimeStamp(null);\n          setAnimatedMessageId(null);\n          setHighLightedMessageId(null);\n        }}\n      />\n      {\n        // This flag is an unmatched variable\n        scrollBottom > SCROLL_BOTTOM_PADDING && (\n          <div\n            className=\"sendbird-conversation__scroll-bottom-button\"\n            onClick={onClickScrollBot}\n            onKeyDown={onClickScrollBot}\n            tabIndex={0}\n            role=\"button\"\n          >\n            <Icon\n              width=\"24px\"\n              height=\"24px\"\n              type={IconTypes.CHEVRON_DOWN}\n              fillColor={IconColors.PRIMARY}\n            />\n          </div>\n        )\n      }\n    </div>\n  );\n};\n\nexport default MessageList;\n"],"names":["getMessagePartsInfo","_ref","allMessages","isMessageGroupingEnabled","currentIndex","currentMessage","currentChannel","replyType","previousMessage","nextMessage","chainTop","chainBottom","compareMessagesForGrouping","previousMessageCreatedAt","createdAt","currentCreatedAt","hasSeparator","isSameDay","DELAY","useSetScrollToBottom","scrollBottom","setScrollBottom","useState","scrollCb","e","element","target","scrollHeight","scrollTop","offsetHeight","_unused","scrollToBottomHandler","useDebounce","SCROLL_BOTTOM_PADDING","MessageList","className","renderMessage","renderPlaceholderEmpty","renderCustomSeparator","renderPlaceholderLoader","hasMorePrev","hasMoreNext","setInitialTimeStamp","setAnimatedMessageId","setHighLightedMessageId","scrollRef","onScrollCallback","onScrollDownCallback","messagesDispatcher","messageActionTypes","currentGroupChannel","disableMarkAsRead","filterMessageList","loading","unreadSince","useChannelContext","store","useSendbirdStateContext","allMessagesFiltered","filter","markAsReadScheduler","config","onScroll","current","clientHeight","isAboutSame","SCROLL_BUFFER","messages","_ref2","type","MARK_AS_READ","payload","channel","push","onClickScrollBot","_scrollRef$current","_scrollRef$current$sc","_scrollRef$current2","_scrollRef$current$of","_scrollRef$current3","handleMessageHeightChange","bottom","handleMessageListHeightChange","handleOnScroll","useHandleOnScrollCallback","hasMore","hasNext","React","createElement","PlaceHolder","PlaceHolderTypes","LOADING","length","NO_MESSAGES","ref","map","m","idx","_sender","_store$config","isByMe","sender","userId","MessageProvider","message","key","messageId","Message","handleScroll","isFrozen","FrozenNotification","UnreadCount","count","unreadMessageCount","time","onClick","_scrollRef$current4","_scrollRef$current$sc2","_scrollRef$current5","_scrollRef$current$of2","_scrollRef$current6","onKeyDown","tabIndex","role","Icon","width","height","IconTypes","CHEVRON_DOWN","fillColor","IconColors","PRIMARY"],"mappings":"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"}